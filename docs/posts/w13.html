<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-08-13">

<title>Lesson 13 - Path dependence – notes-model-thinking</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-eefa51cfd4367a2c2ab6a47af1b603aa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(../images/banner_black_3.jpg);
background-size: cover;
      }
</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">notes-model-thinking</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Lesson 13 - Path dependence</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Model thinking</div>
                <div class="quarto-category">Path dependence</div>
                <div class="quarto-category">PHAT dependence</div>
                <div class="quarto-category">Chaos</div>
                <div class="quarto-category">ESTIC</div>
                <div class="quarto-category">Increasing Returns</div>
                <div class="quarto-category">Urn Models</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-page-left">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 13, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-path-dependence" id="toc-sec-path-dependence" class="nav-link active" data-scroll-target="#sec-path-dependence">Path dependence</a></li>
  <li><a href="#sec-urn-models" id="toc-sec-urn-models" class="nav-link" data-scroll-target="#sec-urn-models">Urn models</a></li>
  <li><a href="#sec-mathematics-on-urn-models" id="toc-sec-mathematics-on-urn-models" class="nav-link" data-scroll-target="#sec-mathematics-on-urn-models">Mathematics on urn models</a></li>
  <li><a href="#sec-path-dependence-and-chaos" id="toc-sec-path-dependence-and-chaos" class="nav-link" data-scroll-target="#sec-path-dependence-and-chaos">Path dependence and Chaos</a></li>
  <li><a href="#sec-path-dependence-and-increasing-returns" id="toc-sec-path-dependence-and-increasing-returns" class="nav-link" data-scroll-target="#sec-path-dependence-and-increasing-returns">Path Dependence and Increasing Returns</a></li>
  <li><a href="#sec-path-dependent-or-tipping-point" id="toc-sec-path-dependent-or-tipping-point" class="nav-link" data-scroll-target="#sec-path-dependent-or-tipping-point">Path dependent or tipping point</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/OrenBochman/notes-model-thinking/edit/main/posts/w13.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OrenBochman/notes-model-thinking/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full column-page-left" id="quarto-document-content">





<section id="sec-path-dependence" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-path-dependence">Path dependence</h3>
<dl>
<dt>Path dependence</dt>
<dd>
Is a property of the state of a complex system at time <span class="math inline">T</span> depends on all prior time steps <span class="math inline">t&lt;T</span>. More plainly that history matters.
</dd>
</dl>
<p>This is clearly quite different from Markov process models where only the current state matters and history does not.</p>
<p>Urn models can help to understand path dependence, and to distinguish between different types of path dependence. 1. deterministic outcome such as what happens today could be path dependent, 2. stochastic path dependence which is an equilibrium distribution over all possible outcomes of what happens in the long run could also be path dependent.</p>
<div id="exm-path-QWERTY" class="theorem example">
<p><span class="theorem-title"><strong>Example 1</strong></span> One of the most famous examples of path dependence involves the standard typewriter keyboard configuration called QWERTY. Initially, there were lots of different keyboard configurations, but it turned out that in the path through which history played out, QWERTY ended up getting locked in due to a process of increasing returns. The more people had QWERTY, the more people wanted it, and the more typewriters that were built with it, and so it became locked in.</p>
</div>
<dl>
<dt>Path dependence</dt>
<dd>
means that outcome probabilities depend on the sequence of previous outcomes, which is called the path.
</dd>
<dt>Phat dependence</dt>
<dd>
means that outcome probabilities depend on past outcomes but not on their order. The past impacts the outcome but it doesn’t necessarily determine it.
</dd>
</dl>

<div class="no-row-height column-margin column-container"><div id="fig-electic-chair" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-electic-chair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt-electric-chair.jpg" class="img-fluid figure-img"></p>
<figcaption>Danges of A.C.</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-electic-chair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The execution of William Kemmler <a href="https://commons.wikimedia.org/wiki/File:Kemmler_ex%C3%A9cut%C3%A9_par_l%27%C3%A9lectricit%C3%A9.jpg">Source</a>
</figcaption>
</figure>
</div><div id="fig-edison-electic-chair" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-edison-electic-chair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt-electric-edison.jpg" class="img-fluid figure-img"></p>
<figcaption>Eddison and The Electric Chair</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-edison-electic-chair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Popular science book on the rivalry between Edison and Tesla
</figcaption>
</figure>
</div></div>
<div id="exm-currents" class="theorem example">
<p><span class="theorem-title"><strong>Example 2 (Tesla v.s. Edison)</strong></span> Alternating current or direct current. Edison was a proponent of direct current, while Tesla was a proponent of alternating current. Edison was the first to develop a power plant, and he developed it using direct current. Tesla developed alternating current, which was more efficient for transmitting electricity over long distances. Edison was a proponent of direct current, and he was also a proponent of the electric chair. He wanted to show that alternating current was dangerous, so he used it to power the electric chair. This was a very public demonstration of the dangers of alternating current. However, alternating current was more efficient for transmitting electricity over long distances, so it ended up winning out. This is an example of path dependence. The outcome probabilities depend on the sequence of previous outcomes. The path that history took mattered. If history had taken a different path, then the outcome would have been different.</p>
</div>
<div id="exm-path-law" class="theorem example">
<p><span class="theorem-title"><strong>Example 3 (The Common Law)</strong></span> The law which evolves through precedent depends on earlier laws and their interpretation made by judges in the past.</p>
</div>
<p>It also the case with institutional choices like having a single payer healthcare system or defined benefits pensions versus defined contributions. These choices can depend on previous institutional choices. Economic success can also depend on sequences of past outcomes. e.g., Ann Arbor had the largest public university while Jackson had the largest prison. Population in Ann Arbor increased from 10,000 in 1910 to 110,000 in 2000 while in Jackson it first increased and then declined and grew only from 31,000 in 1910 to 36,000 in 2000. The public university greatly helped Ann Arbor.</p>
<p>Path dependence often coincide with increasing returns. If you build a university then other educational institutions like hospitals, and law schools that weren’t originally part of the university, could join in. Eventually, you grow through a virtuous cycle. Increasing returns means building success on top of success. Path dependence isn’t the same as increasing returns.</p>
<p>Chaos is often referred to as ESTIC, or <strong>E</strong>xtreme <strong>S</strong>ensitivity <strong>T</strong>o <strong>I</strong>nitial <strong>C</strong>onditions. Chaos means that, even when the starting points A and B are very close to each other, subsequent paths can diverge tremendously. Chaos deals with initial points while path dependence deals with the path. Path dependence in a <em>dynamic process</em> that has a state in each period differs from a Markov process. These path dependent processes violate the <em>fixed transition probabilities</em> assumption of the Markov Process. In Urn models transition probabilities change, and that is how history can matter.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_urn_model.jpg" class="img-fluid figure-img"></p>
<figcaption>Urn model</figcaption>
</figure>
</div></div></section>
<section id="sec-urn-models" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-urn-models">Urn models</h3>
<p><a href="https://en.wikipedia.org/wiki/Urn_problem">Urn models</a> can be used to distinguish between processes that are path-dependent and processes where the order doesn’t matter. They can also be used to distinguish between processes that have outcomes in a given period that are path-dependent, and processes that have long-run equilibria of distributions over the set of outcomes that are path-dependent.</p>
<p>An urn model is a container with blue and red balls. You pick balls out of the urn. The ball you pick is the outcome. There is a probability of picking out balls of different colors. The simplest urn model is the Bernoulli model where Outcomes are independent of previous outcomes. The number of balls in the urn is fixed,</p>
<div id="exm-path-pólya-urn" class="theorem example">
<p><span class="theorem-title"><strong>Example 4 (Pólya urn model)</strong></span> Three red balls and one blue ball. After picking a ball, you return it into the urn. The probability of picking up a red ball is constant and always 3/4.</p>
</div>
<p>The most famous path-dependent process is called the <a href="https://en.wikipedia.org/wiki/P%C3%B3lya_urn_model">Pólya process</a>. It works starts with an urn with two balls, one of them red and one of them blue. You pick a ball, and after you pick that ball, you put back the ball and add another ball of the same color you just picked. This can be repeated over and over again. Over time, probabilities change as more and more balls are added. This process is path-dependent as the probabilities depend on the path of previous choices.</p>
<p>The Pólya process might apply to fashion. If more people are wearing a red shirt, this increases the probability that more people will be wearing red shirts. The interesting properties of the Pólya process are:</p>
<ol type="1">
<li>Any probability of red balls is an equilibrium and equally likely, i.e.&nbsp;3% is as likely as 88%;</li>
<li>Any sequence of <em>R</em> red balls and <em>B</em> blue balls is equally likely, e.g.&nbsp;RBBRB is as likely as RRBBB.</li>
</ol>
<p>The opposite of the Pólya process is the <strong>Balancing Process</strong> where you return the ball but also add a new ball of the opposite color as the ball you just picked. The balancing process converges to equal percentages of the two colors of balls. This might apply to situations where you want to keep different constituencies happy,</p>
<div id="exm-path-party-convention" class="theorem example">
<p><span class="theorem-title"><strong>Example 5</strong></span> e.g.&nbsp;a party convention in the United States might be put it in a northern state or a southern state. If it is put a northern state, this increases the probability that it is going to be put it in a southern state four years later.</p>
</div>
<p>In the Pólya Process, the equilibrium is incredibly path-dependent, but in the balancing process it is not. There is also a distinction between the period outcomes, which is what happens in a particular period, e.g.&nbsp;red or blue, versus what the distribution of balls in the urn looks like in the long run. Path-dependent outcomes means that what happens in a period depends on what happened in the past. That is true for both the Pólya process and the balancing process.</p>
<p>Path-dependent equilibrium means that what happens in the long run depends on the process along the way. The Pólya process has both path-dependent equilibria and path-dependent outcomes. The balancing process only has path-dependent outcomes. The equilibrium is always 1/2 and it doesn’t depend on what happened along the way. In the balancing process, history matters at each step in time. However, that doesn’t mean that what happens in the long run depends on the path.</p>
<p>Two examples from history can illustrate this.</p>
<div id="exm-path-manifest-destiny" class="theorem example">
<p><span class="theorem-title"><strong>Example 6</strong></span> The United States had the idea of manifest destiny, meaning that the United States was likely to be a country that stretched from sea to sea. History played out in particular ways, but some people argue that it didn’t matter as the United States was destined to be a country that stretched from sea to sea.</p>
</div>
<div id="exm-path-railroads" class="theorem example">
<p><span class="theorem-title"><strong>Example 7</strong></span> Another example is the railroads. Some people argue that once the railroads were invented, building them became inevitable. The lay of each track was path-dependent, but the long-run outcome may not have been as the tracks were laid where it was economically efficient.</p>
</div>
<p>Path-dependence means that the outcome probabilities depend on the sequence of past outcomes. Phat-dependence means that outcome probabilities depend on past outcomes but not their order. The Pólya process is phat-dependent. All that matters is the set of outcomes, not the order in which they appeared.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_sway.jpg" class="img-fluid figure-img"></p>
<figcaption>The sway process</figcaption>
</figure>
</div></div><p>Why is the difference between path-dependent versus phat-dependent so important? If there are 30 picks then there are 230 or over a billion different paths. The number of possible sets is only 31. The number of blue balls could have been 0, 1, …, 30. If it is set dependent, there are only 31 different possibilities. If it is path dependent, that means there are more than a billion possibilities.</p>
<p>The sway process is path-dependent. It starts with one blue and one red ball. When a ball is picked, a ball of that same color is added, just like the Pólya process, also <em>2t-s - 2t-s-1</em> balls of the color of the ball chosen in each period <em>s</em> less than <em>t</em>.</p>
<p>e.g., in period one, you pick a blue ball and you add a blue ball. In period two, you pick a red ball, so you add a red ball, and also add a blue ball for the blue ball you picked in period one. In period three, you pick a blue ball and add a blue ball, but also a red ball for the red ball you picked in period two. And now you add two blue balls, so you multiply times two the blue ball that you picked in period one. In period four, you get a red ball, so now you add a red ball, and a blue ball for period three, and two red balls for period two, a four, or two times two, blue balls for period one.</p>
<p>This process is called the sway because, as you go back in time, decisions take on more and more weight. In this way the path is taking on more and more influence. So, when people talk about path dependence, e.g.&nbsp;in law, institutional choices, or technological adoptions, they think about early movers having a bigger effect and the past having an increasing weight. One way you can get full path dependence, is by having that sort of process.</p>
</section>
<section id="sec-mathematics-on-urn-models" class="level3">
<h3 class="anchored" data-anchor-id="sec-mathematics-on-urn-models">Mathematics on urn models</h3>
<p>For the Pólya process, each equilibrium is equally likely, and any history of <em>R</em> red balls and <em>B</em> blue balls is equally likely. This can be proven. The Pólya process starts with one red ball and one blue ball. Then a ball is picked. Then the ball is returned an another ball of the same color is added. This process is repeated. Let’s first prove that any history of <em>B</em> blue balls and <em>R</em> red balls is equally likely because this proof can be used to prove that each equilibrium is equally likely.</p>
<p>Proving that any history of <em>R</em> red balls and <em>B</em> blue balls is equally likely, is easy. e.g., <em>P(RBBB) = (1/2)(1/3)(2/4)(3/5) = (11</em>2<em>3)/(2</em>3<em>4</em>5) = 1/20 and <em>P(BBBR) = (1/2)(2/3)(3/4)(1/5) = (12</em>3<em>1)/(2</em>3<em>4</em>5) = 1/20. Also <em>P(RBRB) = (1/2)(1/3)(2/4)(2/5) = (11</em>2<em>2)/(2</em>3<em>4</em>5) = 1/30 and <em>P(BBRR) = (1/2)(2/3)(1/4)(2/5) = (12</em>1<em>2)/(2</em>3<em>4</em>5) = 1/30.</p>
<p>You first make a pick out of 2 balls. Then you make a pick out of 3 balls. If you make <em>N</em> picks, the denominator will be <em>N!</em>. If you make <em>N</em> picks and end up with <em>B</em> blue balls, you have to pick <em>N-B</em> red balls. For blue balls, you pick first out of 1, then out of 2. This continues until you pick out of <em>B</em>. For red balls, you pick first out of 1, then out of 2. This continues until you pick out of <em>N-B</em>. The numerator will then be <em>B!(N-B)!. So, for any N</em> picks with <em>B</em> blue balls, the probability is (B!(N-B)!)/N!.</p>
<p>It is more difficult to prove that any probability of red balls is an equilibrium that is equally likely to happen. e.g., <em>P(BBBB) = (1/2)(2/3)(3/4)(4/5) = (12</em>3<em>4)/(2</em>3<em>4</em>5) = 1/5 and <em>P(BBBR) = (1/2)(2/3)(3/4)(1/5) = (12</em>3<em>1)/(2</em>3<em>4</em>5) = 1/20. Now, there are four ways in which one red ball could emerge, which are RBBB, BRBB, BBRB and BBBR. They are equally likely to happen, so <em>P(RBBB) + P(BRBB) + P(BBRB) + P(BBBR) = 1/20 + 1/20 + 1/20 + 1/20 = 1/5</em>.</p>
<p>Now <em>P(50B) = P(50R) = (1/2)(2/3)(3/4)…(49/50)(50/51) = 1/51</em>. Now <em>P(49B 1R)</em> is a bit more complicated. The probability of picking 49 blue balls first and 1 red ball last is (1/50)*(1/51). There are 50 ways in which that one red ball could emerge, so <em>P(49B 1R) = P(1B 49R) = 50(1/50</em>51) = 1/51.</p>
<p><em>P(47B 3R)</em> is even more complicated. Assume first that the three red balls are last. You first pick a blue ball with probability 1/2. Then a blue ball with probability 1/2. This goes on until you pick a blue ball with probability 47/48. Then you pick a red ball with probability 1/49, then another red ball with probability 1/50, and another red ball with probability 1/51. So you get a probability of <span class="math inline">(\frac{1}{2})(\frac{2}{3})\ldots(\frac{47}{48})(\frac{1}{49})(\frac{2}{50})(\frac{3}{51}) = \frac{(47!)(3!)}{(51!)} = \frac{(1 \times 2 \times 3)}{(48 \times 49 \times 50 \times 51)}</span>.</p>
<p>There are 3 red balls, so there are 50 places where the first one could have been, then 49 places for the second one, and 48 places for the third one. But picking red balls on places 12, 29, and 38 is the same as 29, 12 and 38 or 38, 12 and 29, so we have to take into account the different orders. Three balls can be in 3<em>2</em>1 = 3! = 6 different orders. Now the probability is <span class="math inline">\frac{(1 \times 2 \times 3)}{(48 \times 49 \times 50 \times 51)} \times \frac{(50 \times 49 \times 48)}{(3 \times 2 \times 1)} = \frac{1}{51}</span>. In this way it is possible to arrive at the conclusion that any probability of red balls is an equilibrium that is equally likely.</p>
</section>
<section id="sec-path-dependence-and-chaos" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-path-dependence-and-chaos">Path dependence and Chaos</h3>
<p>Path dependence means that the outcome probabilities depend on the sequences of past outcomes. There are path dependent outcomes and path dependent long run equilibria. Markov processes have a unique stochastic equilibrium that is not path-dependent. Markov processes are not path dependent because of the fixed transition probabilities. In the urn model where balls are added based on the color of the ball picked, the transition probabilities change.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_tent_map.png" class="img-fluid figure-img"></p>
<figcaption>Tent map function</figcaption>
</figure>
</div></div><p>Path dependence can also be related to chaos. Chaos is often referred to as <strong>ESTIC</strong>, or <strong>e</strong>xtreme <strong>s</strong>ensitivity <strong>t</strong>o <strong>i</strong>nitial <strong>c</strong>onditions. Chaos means that, even when the starting points A and B are very close to each other, then after many iterations of the outcome function they differ by arbitrary amounts.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_tent_map_02.jpg" class="img-fluid figure-img"></p>
<figcaption>Tent map example</figcaption>
</figure>
</div></div><p>Recursive functions can be used to describe processes that are chaotic. In a recursive function, the outcome at time <em>t</em> depends on the outcomes of previous periods, so <em>xt = f(x1, x2, …, xt-2, xt-1)</em>, e.g.&nbsp;f(xt) = xt-1 + 2, which would give 1, 3, 5, 9, 11.</p>
<p>An example is the tent map. For <em>x</em> in <em>(0,1)</em> meaning that <em>0 &lt; x &lt; 1</em>, if <em>x &lt; 1/2</em> then <em>f(x) = 2x</em> and if <em>x ≥ 1/2</em> then <em>f(x) = 2 - 2x</em>. Starting with 0.21 it would give 0.42, 0.84, 0.32, 0.64. An example of the tent map, which starts with two points that are very similar, one being 0.4321, and the other being 0.4322, shows that after a few periods, the two points are a long way away from each other.</p>
<p>The tent map ends up being chaotic because there is extreme sensitivity to the initial condition. This is not path dependence. Once the initial point is chosen, then it is possible to calculate exactly what’s going to happen. So chaos, in its standard form means extreme sensitivity to initial conditions.</p>
<p>A process is independent if outcomes don’t depend on the past history of outcomes. This independence is a probabilistic concept, e.g.&nbsp;a 50% chance of getting a red or blue ball each period. A process depends on the initial conditions if the outcomes depend only on the initial state so that it is completely deterministic. Path dependence means that the outcome probabilities of what happens in the long run, depends on what happens along the way. Phat dependence means that outcome probabilities don’t depend on the order in which things happen but only depend on the set of things.</p>
<p>When historians or institutional scholars think about path dependence, they often think in terms of the sequence of events mattering, not just the set of things mattering. They also think that events aren’t independent, and they think that although initial conditions matter, other things matter too.</p>
<p>If things happened independently then there is no structure in history and that doesn’t make any sense. Extreme sensitivity to initial conditions in a deterministic process doesn’t make sense either. That means that fate is completely predetermined by initial choices. It is also not phat, because then only the set of previous events matters, and not the order. Imagine America buying Louisiana from France before becoming independent. That doesn’t make sense.</p>
</section>
<section id="sec-path-dependence-and-increasing-returns" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-path-dependence-and-increasing-returns">Path Dependence and Increasing Returns</h3>
<p>Increasing returns means that, the more there is of something, or the more people that do something, the more people want of it, or the more other people are going to do it. e.g., the more people to get QWERTY typewriters, and the more other people want these typewriters. There are two reasons for this. First, people can then use somebody else’s machine more easily. Second, from a production standpoint, it makes more sense to standardize. So there are positive feedbacks. More produces more.</p>
<p>This is like the Pólya process. The more blue balls are picked, the more likely blue balls are picked in the future. So, many people think that increasing returns cause path dependence. Both the sway and the Pólya process have increasing returns. The balancing process, which doesn’t produce path dependence, didn’t have increasing returns. In fact, it had decreasing returns. The more red balls were picked, the more blue balls were picked in the urn.</p>
<p>Is increasing returns the same thing as path dependence? You can get increasing returns without path dependence. The gas/electric model represents the choice between gas cars and electric cars. Both had a positive feedback, e.g.&nbsp;more cars of a specific type meant more production and more filling stations of a specific type. However, when automobiles were first developed, gas cars had much larger increasing returns than electric cars because of the storage problems for electricity. Furthermore, you can add a gas engine to an electric car, so adding an electric engine also makes another gas engine more likely.</p>
<p>This can be represented by the following model. Assume that you start with five blue balls and one red ball. If you pick a red ball, you add one red ball and one blue ball. If you pick a blue ball, you add ten blue balls. The chance of picking a blue ball first is 1/5. If that happens, the chance of picking another blue ball is 2/7. These are increasing returns. Increasing returns to blue balls are much larger. If you run this process, the blue balls win out every single time. This process isn’t path dependent, but it has increasing returns, hence increasing returns are not the same as path-dependence.</p>
<p>You can also get path dependence without increasing returns, e.g.&nbsp;with symbiotes. You start with one red ball, one blue ball, one green ball, and one yellow ball in the urn. If a red ball is picked, you add a green one. If a green ball is picked, you add a red one. If a blue ball is picked, you add a yellow one. If a yellow ball is picked, you add a blue one. There are no increasing returns, because if a red ball is added, this increases the odds of green. If you order the balls into two sets, which are <em>{red, green}</em> and <em>{blue, yellow}</em> then the process is path-dependent but doesn’t have increasing returns.</p>
<p>Increasing returns is logically distinct from path dependence but often in history path-dependence was caused by increasing returns. The urn models can be used to clarify that. Increasing returns is not the only way you get path dependence. To understand that, you have to move beyond urn models and look at externalities or the interdependencies between decisions.</p>
<div id="exm-path-public-projects" class="theorem example page-columns page-full">
<p><span class="theorem-title"><strong>Example 8</strong></span> <strong>Public projects</strong> like building a nuclear power plant, or creating a national park, are huge economic decisions that affect a lot of other things, so they create externalities.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_externalities.jpg" class="img-fluid figure-img"></p>
<figcaption>Projects and externalities</figcaption>
</figure>
</div></div><p>This can be illustrated using model. Assume there are five projects A, B, C, D, and E. Each one has a value of 10 of its own but they also create some externalities. The matrix represents the size of the externalities between projects, e.g.&nbsp;the externalities between project A and project B are -10. If you start with A, the returns are 10. If you then plan to to B, then AB returns 10 + 10 + 20 = 0, so it doesn’t make sense to to B after A.</p>
<p>Now AC returns 10 + 10 + 5 = 25 so it makes sense to do C after A. Now doing ACD returns 10 + 10 + 5 + 10 - 10 + 0 = 25, so doing D after AC makes no difference. If you start with B first, then it makes no sense to to A. After doing B, there is no benefit from doing C so C might not happen. D will be done because of the externality of 30 with B.</p>
</div>
<p>The projects that get done don’t only depend on the initial conditions, in this case the project picked first, but also on the externalities of the projects that have been done in the past. If most of the externalities are positive, there is less path-dependence than when the externalities are negative, because positive externalities create increasing returns and make other projects more likely. A big cause of path-dependence is externalities.</p>
</section>
<section id="sec-path-dependent-or-tipping-point" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-path-dependent-or-tipping-point">Path dependent or tipping point</h2>
<p>Path dependence and tipping points seem closely related concepts. Path dependence means that outcome probabilities depend on the sequence of past outcomes. There are path dependent outcomes, meaning that what happens in a given period depends on the path, and path dependent equilibria, meaning that what happens in the long run depends on what happens along the way. Tipping points are related to path-dependent equilibria.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_active_tip.jpg" class="img-fluid figure-img"></p>
<figcaption>Active tip</figcaption>
</figure>
</div></div><p>Recall that there are two types of tipping points:</p>
<dl>
<dt>Direct/Active tip</dt>
<dd>
<p>a variable itself changes, which causes it to tip. In Schelling’s model this is the agent moving house.</p>
</dd>
<dt>Contextual tip</dt>
<dd>
<p>a change in the environment triggers one or more transitions in the system. In Schelling’s model this is a preferred neighbor moving out or a unwanted neighbor moving in.</p>
</dd>
</dl>
<p>Path dependence can be related to direct tips.</p>
<p>The difference between path-dependence and tipping points is that path-dependence means that what happened along the way has an effect. Each step may have a small effect. A tipping point is a single instance in time where, where the equilibrium suddenly changes drastically. A singular event suddenly tips the system abruptly.</p>
<p>To measure tips, you can use measures of uncertainty like the diversity index, which shows the probability of different equilibria, and entropy, which measures how much information there is in the system. For the Pólya process any probability distribution of red balls is an equilibrium and equally likely. When drawing four balls, five things could happen, which are drawing zero, one, two, three or four red balls. Each is equally likely, so the probability of each option is 1/5 so the diversity index is 5.</p>
<p>Suppose that the first ball is red. Then the following could happen. The probability of having four red balls is <em>(2/3)(3/4)(4/5) = 2/5</em>. The probability of having three red balls and one blue ball is <em>(2/3)(3/4)(1/5)3 = (1/10)</em>3 = 3/10 as the blue ball could be in three locations. The probability of having two red balls and two blue balls is <em>(2/3)(1/4)(2/5)3 = (1/15)</em>3 = 1/5 as the additional red ball could be in three locations. The probability of having four blue balls is <em>(1/3)(2/4)(3/5) = 1/10</em>. Now, <em>P(4R) = 4/10</em>, <em>P(4R) = 4/10</em>, <em>P(3R) = 3/10</em>, and <em>P(1R) = 1/10</em>, so the diversity index is <em>1/((4/10)² + (3/10)² + (2/10)² + (1/10)²) = 30/100 ≈ 3.33</em>.</p>
<p>This movement of the diversity index suggests that something happened along the path affecting the outcome probabilities. There is path dependence, but it is not abruptly tipped. Abruptly tipped would be moving from 5 to 1 or 1.2 so that one single event would get rid of a lot of uncertainty. The difference between path dependence and tipping points is one of degree. Path dependence is more gradual. Tipping points are more abrupt.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_school_network.jpg" class="img-fluid figure-img"></p>
<figcaption>School friendship network</figcaption>
</figure>
</div></div><section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>Note: this page is based on the following source:</p>
<ul>
<li><span class="citation" data-cites="page2017modelthinking">(<a href="#ref-page2017modelthinking" role="doc-biblioref">Page 2014</a>)</span> MOOC, Course material &amp; Transcripts.</li>
<li>TA Notes by <span class="citation" data-cites="fisher2017modelthinking">(<a href="#ref-fisher2017modelthinking" role="doc-biblioref">Fisher 2014</a>)</span>.</li>
<li>Student notes by in <span class="citation" data-cites="kleinikink2016naturalmoney">(<a href="#ref-kleinikink2016naturalmoney" role="doc-biblioref">Klein Ikink 2016</a>)</span> and <span class="citation" data-cites="groh2017model">(<a href="#ref-groh2017model" role="doc-biblioref">Groh 2017</a>)</span>.</li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-fisher2017modelthinking" class="csl-entry" role="listitem">
Fisher, Steve. 2014. <span>“Model Thinking – TA Notes.”</span> <a href="https://www.coursera.org/learn/model-thinking" class="uri">https://www.coursera.org/learn/model-thinking</a>; Coursera. November 2014.
</div>
<div id="ref-groh2017model" class="csl-entry" role="listitem">
Groh, Rainer. 2017. <span>“Model Thinking - Course Notes by Rainer Groh.”</span> <a href="https://aerospaceengineeringblog.com/wp-content/uploads/2017/11/ModelThinking.pdf" class="uri">https://aerospaceengineeringblog.com/wp-content/uploads/2017/11/ModelThinking.pdf</a>. November 2017.
</div>
<div id="ref-kleinikink2016naturalmoney" class="csl-entry" role="listitem">
Klein Ikink, Bart. 2016. <span>“Model Thinking.”</span> <a href="https://naturalmoney.org/modelthinking-01.html" class="uri">https://naturalmoney.org/modelthinking-01.html</a>. March 2016.
</div>
<div id="ref-page2017modelthinking" class="csl-entry" role="listitem">
Page, Scott E. 2014. <span>“Model Thinking [MOOC].”</span> <a href="https://www.coursera.org/learn/model-thinking" class="uri">https://www.coursera.org/learn/model-thinking</a>; Coursera. November 2014.
</div>
</div>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{2023,
  author = {},
  title = {Lesson 13 - {Path} Dependence},
  date = {2023-08-13},
  url = {https://orenbochman.github.io/notes-model-thinking/posts/w13.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-2023" class="csl-entry quarto-appendix-citeas" role="listitem">
<span>“Lesson 13 - Path Dependence.”</span> 2023. August 13, 2023. <a href="https://orenbochman.github.io/notes-model-thinking/posts/w13.html">https://orenbochman.github.io/notes-model-thinking/posts/w13.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2023-2025, Oren Bochman</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/OrenBochman/notes-model-thinking/edit/main/posts/w13.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OrenBochman/notes-model-thinking/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with 💛 and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>