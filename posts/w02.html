<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-08-02">

<title>Lesson 2 - Segregation and Peer Effects – notes-model-thinking</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-eefa51cfd4367a2c2ab6a47af1b603aa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner {
        background: /images/banner_black_3.jpg;
      }
</style>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">notes-model-thinking</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Lesson 2 - Segregation and Peer Effects</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">model thinking</div>
                <div class="quarto-category">sorting</div>
                <div class="quarto-category">peer effects</div>
                <div class="quarto-category">segregation</div>
                <div class="quarto-category">homophily</div>
                <div class="quarto-category">Schelling's Segregation Model</div>
                <div class="quarto-category">Index of Dissimilarity</div>
                <div class="quarto-category">Granovettor's Threshold Model</div>
                <div class="quarto-category">Standing Ovation Model</div>
                <div class="quarto-category">the Identification Problem</div>
                <div class="quarto-category">Agent-Based Modelling</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta column-body">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 2, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-segregation_and_peer_effects" id="toc-sec-segregation_and_peer_effects" class="nav-link active" data-scroll-target="#sec-segregation_and_peer_effects">Segregation and Peer Effects</a></li>
  <li><a href="#sorting_and_peer_effects" id="toc-sorting_and_peer_effects" class="nav-link" data-scroll-target="#sorting_and_peer_effects">Sorting and peer effects introduction</a></li>
  <li><a href="#sec-schellings_segregation_model" id="toc-sec-schellings_segregation_model" class="nav-link" data-scroll-target="#sec-schellings_segregation_model">Schelling’s Segregation Model</a>
  <ul class="collapse">
  <li><a href="#insights" id="toc-insights" class="nav-link" data-scroll-target="#insights">Insights</a></li>
  </ul></li>
  <li><a href="#sec-measuring_segregation" id="toc-sec-measuring_segregation" class="nav-link" data-scroll-target="#sec-measuring_segregation">Measuring Segregation</a>
  <ul class="collapse">
  <li><a href="#sec-index-of-dissimilarity" id="toc-sec-index-of-dissimilarity" class="nav-link" data-scroll-target="#sec-index-of-dissimilarity">The Index of Dissimilarity</a></li>
  <li><a href="#sec-gen-index-of-dissimilarity" id="toc-sec-gen-index-of-dissimilarity" class="nav-link" data-scroll-target="#sec-gen-index-of-dissimilarity">A Generalized Index of Dissimilarity</a></li>
  <li><a href="#morans-i" id="toc-morans-i" class="nav-link" data-scroll-target="#morans-i">Moran’s I</a></li>
  <li><a href="#sec-interaction-or-exposure-index" id="toc-sec-interaction-or-exposure-index" class="nav-link" data-scroll-target="#sec-interaction-or-exposure-index">Interaction or Exposure Index (B)</a></li>
  <li><a href="#sec-segregation-in-multiple-categories-entropy-index" id="toc-sec-segregation-in-multiple-categories-entropy-index" class="nav-link" data-scroll-target="#sec-segregation-in-multiple-categories-entropy-index">Segregation in Multiple Categories: Entropy Index</a></li>
  </ul></li>
  <li><a href="#segregation-in-the-wild." id="toc-segregation-in-the-wild." class="nav-link" data-scroll-target="#segregation-in-the-wild.">Segregation in the Wild.</a></li>
  <li><a href="#peer_effects" id="toc-peer_effects" class="nav-link" data-scroll-target="#peer_effects">Peer Effects</a></li>
  <li><a href="#sec-granovettors-model" id="toc-sec-granovettors-model" class="nav-link" data-scroll-target="#sec-granovettors-model">Granovettor’s Threshold Model</a></li>
  <li><a href="#sec-standing_ovation_model" id="toc-sec-standing_ovation_model" class="nav-link" data-scroll-target="#sec-standing_ovation_model">The Standing Ovation Model</a></li>
  <li><a href="#sec-identification_problem" id="toc-sec-identification_problem" class="nav-link" data-scroll-target="#sec-identification_problem">The Identification problem</a>
  <ul class="collapse">
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/OrenBochman/notes-model-thinking/edit/main/posts/w02.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OrenBochman/notes-model-thinking/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full column-body" id="quarto-document-content">





<section id="sec-segregation_and_peer_effects" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-segregation_and_peer_effects">Segregation and Peer Effects</h2>
<p>In this lesson we get started by looking</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
TLDR: Schelling👍🏽, Granovettor,👍🏽 Standing Ovation 👍🏽
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a great lesson in which we cover lots of material:</p>
<ul>
<li>Schelling’s model, in which segregation emerges from localized homophily. This simple and fertile model spawned generations of related models, such as the following.</li>
<li>Emergent properties of local models and Schelling’s book “Micro Motives and Macro Behaviour”</li>
<li>How to Measure segregation.</li>
<li>Granovettor’s threshold model: which explains why riots are hard to forecasts, and</li>
<li>The standing ovation model</li>
<li>the Identification Problem</li>
</ul>
</div>
</div>
<div class="column-screen">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">mindmap
  root((Segregation &lt;br&gt;Peer Effects &lt;br&gt; Threshold))
    Homophily
        (Schelling's Segregation)
            {{phase changes}}
              ((integration))
              ((segregation))
              ((nomads))
            {{Cascades}}
              {{Genesis}}
              {{Exsedos}}
            )metrics(
              {{index of dissimilarity}}
              {{gini index}}
            )Mechanisms(
              {{Sorting}}
            {{Social Roles}}
              {{unhappy}}
              {{happy}}
    Peer Effects     
        (Granovetter collective behavior)
            {{Effects}}
              {{Radicalization}}
              {{Rioting}}
              {{Black-Swans}}
            {{Social Roles}}
              {{Radicals}}
              {{Fans}}
            )Mechanism(
              {{Contagation}}
        (Standing Ovation)
          {{Social Roles}}
              {{Celebrity}}
              {{Academic}}
          )Mechanism(
              {{Percolation}}
              {{BandWagon}}
            

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>
<p>Some questions about segregation and segregation models:</p>
<ol type="1">
<li>How many time steps are needed for segregating in a 50x50 city? <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li>Does convergence time change with city dimensions? <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>Which segregation level can we expect from an intolerance level of 1/3? <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
<li>What happens to the convergence time if we increase the intolerance? And to the final segregation level? <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></li>
</ol>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;in <span class="citation" data-cites="Mauro2022segregation">Nanni (<a href="#ref-Mauro2022segregation" role="doc-biblioref">2023</a>)</span></p></div><div id="fn2"><p><sup>2</sup>&nbsp;in <span class="citation" data-cites="Mauro2022segregation">Nanni (<a href="#ref-Mauro2022segregation" role="doc-biblioref">2023</a>)</span></p></div><div id="fn3"><p><sup>3</sup>&nbsp;in <span class="citation" data-cites="Mauro2022segregation">Nanni (<a href="#ref-Mauro2022segregation" role="doc-biblioref">2023</a>)</span></p></div><div id="fn4"><p><sup>4</sup>&nbsp;in <span class="citation" data-cites="Mauro2022segregation">Nanni (<a href="#ref-Mauro2022segregation" role="doc-biblioref">2023</a>)</span></p></div><div class="">
<p><strong>Legend</strong></p>
<ul>
<li>Red is White,</li>
<li>Blue is Black,</li>
<li>Green is Asian,</li>
<li>Orange is Hispanic,</li>
<li>Gray is Other,</li>
<li>each dot is 25 people</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/segregation_huston.jpg" class="img-fluid figure-img"></p>
<figcaption>Race &amp; ethnicity: Huston by <a href="https://www.flickr.com/photos/walkingsf/albums/72157624812674967/">Erica Fischer</a> CC-BY-SA</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/segregation_chicago.jpg" class="img-fluid figure-img"></p>
<figcaption>Race &amp; ethnicity: Chicago by <a href="https://www.flickr.com/photos/walkingsf/albums/72157624812674967/">Erica Fischer</a> CC-BY-SA</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/segregation_ny.jpg" class="img-fluid figure-img"></p>
<figcaption>Race &amp; ethnicity: New York by <a href="https://www.flickr.com/photos/walkingsf/albums/72157624812674967/">Erica Fischer</a> CC-BY-SA</figcaption>
</figure>
</div>
</div></div>
</section>
<section id="sorting_and_peer_effects" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sorting_and_peer_effects">Sorting and peer effects introduction</h2>
<p>Why do individuals who study, reside, or spend time together often exhibit similarities in appearance, thought processes, and behaviors?</p>
<p>Any number of mechanisms may lead to the creation of homogeneous groups. We will study primarily the first two of the following mechanisms:</p>
<dl>
<dt>Sorting effect</dt>
<dd>
<p>preferential exodus into neighborhoods with similar neighbors increases homogeneity.</p>
</dd>
<dt>Peer effect</dt>
<dd>
<p>Social pressure from peers causes people to conform or to leave, increasing homogeneity.</p>
</dd>
<dt>Bandwagon effect:</dt>
<dd>
<p>a follow-the-leader effect first noticed in politics. c.f. <a href="https://en.wikipedia.org/wiki/Bandwagon_effect">bandwagon effect</a>** in the many context <em>innovation, marketing, economics</em> ,</p>
</dd>
</dl>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_underdog_cat.jpg" class="img-fluid figure-img"></p>
<figcaption>when the underdog is just a kitten</figcaption>
</figure>
</div></div><dl>
<dt>Under Dog effect</dt>
<dd>
<p>Similar to a bandwagon effect but where the group arises around a weaker candidate and is sometimes observed in <strong>politics</strong>,</p>
</dd>
</dl>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_contagation.jpg" class="img-fluid figure-img"></p>
<figcaption>In contagion, we can see several mechanisms for spreading of illness and romours</figcaption>
</figure>
</div></div><dl>
<dt>Critical-mass/density effects</dt>
<dd>
<p>In contagion model <em>epidemiology</em>. We see that a critical mass or density is enough for a seed of sickness to spread to most of the population.</p>
</dd>
</dl>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_market_for_lemmon2s.jpg" class="img-fluid figure-img"></p>
<figcaption>Adverse selection can create a market for lemons</figcaption>
</figure>
</div></div><dl>
<dt>Adverse Selection</dt>
<dd>
<p>When most sellers lack incentives to participate in a market, we end up with a homogenous market full of inferior products. This was investigated in the seminal paper <span class="citation" data-cites="Akerlof1970Lemons">(<a href="#ref-Akerlof1970Lemons" role="doc-biblioref">Akerlof 1970</a>)</span> called the “Market for Lemons,” where the author discusses <strong>adverse selection</strong> in <em>economics</em></p>
</dd>
</dl>
<p>If you look at the map of Detroit, you see that people of different ethnicity tend to live together in segregated communities. Birds of a feather flock together, and people who look like each other tend to live together. Since people can not change their skin color, the mechanism for this is <strong>Sorting</strong>.</p>
<p>Alternatively, people could adapt their behavior to match that of others around them. e.g., kids who hang around with kids that are smoking may take an occasional cigarette, and start smoking in this way. Alternatively, if you hang out with people who are serious about their health and don’t smoke, then you might decide to quit smoking. These are examples of <strong>peer effects</strong>.</p>
<p>Both <em>sorting</em> and <em>peer effects</em> create uniformity within groups. Models have been developed to better understand these mechanisms. Their results have revealed some unexpected insights. In many cases where uniformity is observed, the mechanism that creates the effect isn’t clear. We can’t tell if we are dealing with sorting, peer effects, a combination, or something else. In other words, a model is not an alternative to research. The models we will consider include:</p>
<ul>
<li><em>Schelling’s segregation model</em> tries to explain how segregation is driven by sorting.</li>
<li><em>Granovettor’s Threshold model</em>, which is centered around how a minority’s willingness to participate in some collective behavior can define the behavior of the whole group.</li>
<li><em>The standing ovation model</em> explains how uniformity arises through a peer effect.</li>
<li>How we can distinguish between sorting and peer effects is called the <strong>identification problem</strong>.</li>
</ul>
<p>There are different types of models:</p>
<ul>
<li><strong>Formal Model</strong> These are primarily mathematical and logical specifications. The idea behind formalism in mathematics is that most theories, when specified with great precision, lead to greater insights and elimination of paradoxical results. However, a formal model is usually the result of a deep analysis of informal models.</li>
<li><strong>Game theoretical Models</strong> are models involving agents that rationally, following a detailed strategy which maximizes their expected rewards. In this sense their actions can be called optimal. However many real world optimization problems defy an optimal solution.</li>
<li><strong>Agent based models</strong> use agents to represent individuals, organizations or even countries. The agents follow simple rules that govern their behavior and are implemented using framework like NetLogo or Mesa.</li>
</ul>
<p>ABMs are easy to code, particularly when we know an ABM framework. ABMs can be iteratively refined or simplified. ABMs can be made interactive - which facilitates quick exploratory analysis. ABMs are amenable to automated analysis. Which might reveal optimal strategies that let us proceed to a Game Theoretical model Alternatively, we might use them to formalize the model by deriving some equations that describe the emergent macroscopic behavior. The agents may also be given the capacity to learn more optimal behavior using RL (reinforcement learning). ABM may be tested for their capacity to match real-world phenomena. ABM models that are a good fit can also be calibrated to match the behavior in observed data more closely.</p>
<p>For example, there are many Formal Contagion models that use PDEs to model epidemics. While SIRX models can just as easily handle billions of patients as thousands. However, they cannot be readily queried to check the effectiveness of different mitigation methods for a disease. ABMs, Although limited to 100,000 agents, were used to explore mitigations in various scenarios like nursing homes, primary schools, secondary schools, and even prisons. They were also modified to match specific cases and calibrated using a few real test cases.</p>
<p>Thus, ABMs can give us a high value for our effort and fit into a rapid response.</p>
</section>
<section id="sec-schellings_segregation_model" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-schellings_segregation_model">Schelling’s Segregation Model</h2>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_mm.jpg" class="img-fluid figure-img"></p>
<figcaption>Schelling’s Book Micro Motives &amp; Macro Behavior</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_ny_ethnic_coding.jpg" class="img-fluid figure-img"></p>
<figcaption>New York - coded ethnically</figcaption>
</figure>
</div>
<ul>
<li>Red is White,</li>
<li>Blue is Black,</li>
<li>Green is Asian,</li>
<li>Orange is Hispanic,</li>
<li>Yellow is Other, each dot is 25 residents.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_ny_economic_coding.jpg" class="img-fluid figure-img"></p>
<figcaption>New York - economically coded</figcaption>
</figure>
</div>
<p>An examination of New York’s demographic distribution, represented on a color-coded map where red dots signify upper-class agents, blue dots denote lower-class agents, and moderately blue dots indicate middle-class agents, reveals that the city is ethnically and economically segregated.</p>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_far_from_heaven.jpg" class="img-fluid figure-img"></p>
<figcaption>The plot of ‘Far From Heaven’ touches on peer-effects leading to segregation</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_schelling_01.jpg" class="img-fluid figure-img"></p>
<figcaption>Schelling board</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_netlogo_01.jpg" class="img-fluid figure-img"></p>
<figcaption>Schelling Netlogo - start</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_netlogo_02.jpg" class="img-fluid figure-img"></p>
<figcaption>Schelling Netlogo end</figcaption>
</figure>
</div></div>



<p>In research papers <span class="citation" data-cites="schelling1969models">(<a href="#ref-schelling1969models" role="doc-biblioref">Schelling 1969</a>)</span>, <span class="citation" data-cites="schelling1971dynamic">(<a href="#ref-schelling1971dynamic" role="doc-biblioref">Schelling 1971</a>)</span>, and later in <span class="citation" data-cites="schelling1978micromotives">(<a href="#ref-schelling1978micromotives" role="doc-biblioref">Schelling 1978</a>)</span>, his famous yet erudite opus Nobel Laureate in Economist and noted game theorist <a href="https://en.wikipedia.org/wiki/Thomas_Schelling">Thomas Schelling</a> outlines how he applied his unique brand of game theory to explore how ethnic and income-based segregation arises in a city. Schelling worked out his model by hand using a game board for a city and some pennies for his agents. He soon discovered that encoding homophily as an incentive for agents to relocate rapidly segregated his city.</p>
<p>Today we can simulate using Agent Based Modeling (ABM) packages like <a href="https://www.netlogoweb.org/launch#http://ccl.northwestern.edu/netlogo/models/models/Sample%20Models/Social%20Science/Segregation.nlogo">Netlogo</a> or <a href="w02_schelling_mesa.html">Mesa</a> to implement Schelling’s model. with different thresholds.</p>
<div id="tbl-segregation-simulations" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-segregation-simulations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: outcomes for different thresholds
</figcaption>
<div aria-describedby="tbl-segregation-simulations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 27%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>threshold</th>
<th>initial unhappiness</th>
<th>final unhappiness</th>
<th>final similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>15%</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>40%</td>
<td>28%</td>
<td>0%</td>
<td>80%</td>
</tr>
<tr class="odd">
<td>52%</td>
<td>54%</td>
<td>0%</td>
<td>94%</td>
</tr>
<tr class="even">
<td>80%</td>
<td>90%</td>
<td>–</td>
<td>50%</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<!-- add a mesa bach simulation to create a table -->
<!-- add a mesa shineyapp to make it interactive -->
<p>we can see that a slight preference of homogeneity leads to almost full segregation in this model. From watching the simulation, we can see that most cascades are concentrated at the boundary of segregated zones and that unhappiness will often be minimized by reducing the boundary to a single line from one edge of the city to another.</p>
<section id="insights" class="level3">
<h3 class="anchored" data-anchor-id="insights">Insights</h3>
<p>The insights of simulating Schelling’s model are:</p>
<ol type="1">
<li>Segregation and other emergent macro-level effects may not reflect the behavior and preferences of individuals at the micro level. We see that individuals who are happy so long as they live with just a minimal proportion of their ethnic group within their vicinity will ultimately find themselves in a state of pronounced segregation.</li>
<li>Segregation actually breaks down if intolerance gets too high enough.</li>
</ol>
<p>In this course, we will return to the idea of tipping points. But lacking a clear definition makes the discussions rather pedestrian at times.</p>
<p>I like to think of a tipping point as a critical point in systems dynamics at which there is a discontinuity in macroscopic behavior. Phase changes are best understood in physical systems, where we often find that they have higher-dimensional geometry since the phase change depends on multiple factors.</p>
<p>What Scott calls “a tip” is more straightforward to understand if we call it “a cascade,” which I define as “a chain reaction or sequence of events arising from a single cause.” Not all models exhibit cascades, but when they do, they are a significant part of how the micro is transformed into the macro.</p>
<p>Unfortunately, the simulation I looked at in NetLogo and Mesa doesn’t show how to keep track of cascades and visualize them in real time. The <strong>tipping points</strong> in this model are the thresholds described above at which we will see large-scale segregation emerge, and the second one is where it stops, and we see permanent churn emerge. What are described below are cascades.</p>
<p>Schelling’s model has a cascade phenomenon. For example, if one person moves, this may trigger another person to move, and so on.</p>
<ul>
<li><p>There is an <strong>Exodus cascade</strong>, which means that a person will leave if a similar person in the neighborhood leaves. The trigger for this cascade for <span class="math inline">X</span> is due to a like-me neighbor leaving and thus decrementing the numerator of the ‘threshold’ equation from <span class="math inline">N/D</span>, which is still happy, to <span class="math inline">(N-1)/D</span>, which is no longer happy, thus triggering <span class="math inline">X</span>’s move. These exodus cascades will start with the most intolerant neighbor of <span class="math inline">X</span>, but others with lower thresholds may follow dropping.</p></li>
<li><p>There is also a <strong>Genesis cascade</strong>, in which a person at <span class="math inline">X</span> could become unhappy if a “different” type of person moves into one of the vacant apartments in his neighborhood, <span class="math inline">Y</span>. This will happen if <span class="math inline">X</span>’s threshold is triggered by a denominator increase, i.e., <span class="math inline">X</span> was happy at <span class="math inline">N/D &lt; T</span>, but at <span class="math inline">N/(D+1) &gt;= T</span>, <span class="math inline">X</span> is no longer happy. Genesis events may cascade if more individuals like <span class="math inline">Y</span> move into the mixed neighborhood, occupying additional vacant apartments nearby. They can trigger an exodus cascade, creating more vacant lots and clearing the way for further genesis.</p></li>
</ul>
<p>In most major urban centers with individuals of diverse ethnic backgrounds, there exists a pronounced segregation along racial lines despite the prevalent desire among the populace to reside in ethnically mixed communities.</p>
<p>Note:</p>
<ol type="1">
<li><strong>The threshold</strong> is held fixed in this model, but in reality, it is a distribution.</li>
<li>The rich are a minority &amp; the poor are a majority in most cities.</li>
<li>The model is biased in the sense that an agent only get unhappy due to lack of self same neighbors. We can just as easily let them get unhappy if there is no diversity by adding a threshold for that. This should allow people to move nearer to the segregated zone or perhaps into an integrated area. This might make the boundaries expand or even setup zones of higher and lower homogeneity.</li>
<li>if people with lower thresholds decide to move towards the boundary from both sides. If we gave houses a price element that reflected the supply and demand for different preferences, we could see</li>
</ol>
</section>
</section>
<section id="sec-measuring_segregation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-measuring_segregation">Measuring Segregation</h2>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_measure_seggregation_01.jpg" class="img-fluid figure-img"></p>
<figcaption>Measuring segregation</figcaption>
</figure>
</div></div><p>In this lesson, we set our sights on the <strong>Index of Dissimilarity</strong> as a measure of segregation between two demographic groups living in the same metropolitan region. Its advantage is it’s easy to calculate. Its main shortcoming is that it cannot handle multiple groups, nor can it deal with a continuous variable like wealth. In this section, we consider wealth a dichotomous variable: people are either rich or poor.</p>
<p>What I wanted from this section was to learn the logic for creating such statistics/metrics by myself. I guess that this is not so easy as it seems. However there are a number of other approaches for evaluating segregation and wealth in equality.</p>
<p>Metrics follows</p>
<p>The metric we developed for evaluating segregation called <strong>The index of dissimilarity</strong> was introduced in <span class="citation" data-cites="duncan1955methodological">(<a href="#ref-duncan1955methodological" role="doc-biblioref">Duncan and Duncan 1955</a>)</span>.</p>
<p>Let’s posit a scenario in which a mix of upper and lower class agent live in 24 residential tracts, each inhabited by 10 individuals. Within this configuration, 12 luxury tracts are priced exclusively for rich individuals, 6 tracts of public residential facilities cater only the poor while the remaining 6 tracts share a demographic mix of rich and poor in equal proportion.</p>
<p>The aggregate count of the upper class is <span class="math display">
12\times 10 + 6\times 5 = 150
</span></p>
<p>Whereas the total number of the lower class amounts to <span class="math display">
6\times 10 + 6\times 5 = 90
</span></p>
<p>Let</p>
<ul>
<li><span class="math inline">b</span> be the quantity of a particular group within a tract,</li>
<li><span class="math inline">B</span> be the aggregate quantity of that group (150),</li>
<li><span class="math inline">y</span> be the quantity of the contrasting group within that tract,</li>
<li><span class="math inline">Y</span> be the total number of the contrasting group (90),</li>
</ul>
<p>then the difference between the proportions <span class="math inline">\frac{b}{B}</span> and <span class="math inline">\frac{y}{Y}</span>, or</p>
<p><span id="eq-dissimilarity-metric"><span class="math display">
\left | \frac{b}{B} - \frac{y}{Y} \right | \qquad
\tag{1}</span></span></p>
<p>Serves as an indicator of the extent to which the distribution in the tract deviates from a state of diversity.</p>
<p>Utilizing this metric, a perfectly homogenous tract would possess</p>
<p><span class="math inline">|\frac{b}{B} - \frac{y}{Y}| = \frac{5}{150} - \frac{3}{90} | = 0.</span></p>
<p>For the blue tracts: <span class="math display"> \left |\frac{b}{B} - \frac{y}{Y} \right | = \left | \frac{10}{150} - \frac{0}{90} \right | = \frac{1}{15}</span> For the yellow tracts: <span class="math display">\left | \frac{b}{B} - \frac{y}{Y} \right | = \left | \frac{0}{150} - \frac{10}{90} \right | = \frac{1}{9}</span></p>
<p>For the green tracts: <span class="math display"> \left |\frac{b}{B} - \frac{y}{Y} \right | = \left | \frac{5}{150} - \frac{5}{90} \right | = \frac{1}{45}</span></p>
<section id="sec-index-of-dissimilarity" class="level3">
<h3 class="anchored" data-anchor-id="sec-index-of-dissimilarity">The Index of Dissimilarity</h3>
<p><span id="eq-index-of-dissimilarity"><span class="math display">
(\frac{1}{2}\sum |\frac{b}{B} - \frac{y}{Y}|) \qquad
\tag{2}</span></span></p>
<p>We sum the individual differences and then divide them by 2 to keep the range of the index between 0 and 1.</p>
<ul>
<li>0 indicates heterogeneity.</li>
<li>1 indicates homogeneity.</li>
</ul>
<p>For the example above, you have</p>
<p><span class="math display">\frac{1}{2} \left (\frac{12}{15} + \frac{6}{9} + \frac{6}{45} \right ) =\frac{72}{90} = 0.8</span></p>
<p>Which is highly segregated.</p>
</section>
<section id="sec-gen-index-of-dissimilarity" class="level3">
<h3 class="anchored" data-anchor-id="sec-gen-index-of-dissimilarity">A Generalized Index of Dissimilarity</h3>
<p><span id="eq-gen-index-of-dissimilarity"><span class="math display">
D_G = \frac{1}{2} \frac{\sum_j \sum_i \left | N_{ij}-E_{ij}\right |}{\sum NP_j(1-P_j)} \qquad
\tag{3}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">E_{ij} = \frac{N_i N_j}{N}</span></li>
<li><span class="math inline">P_j = \frac{N_j}{N}</span></li>
</ul>
</section>
<section id="morans-i" class="level3">
<h3 class="anchored" data-anchor-id="morans-i">Moran’s I</h3>
<p><strong>Moran’s I</strong> is a measure of spatial autocorrelation. The statistic for a spatial variable <span class="math inline">x_h</span> over the occupied cells follows <a href="#eq-moran-I" class="quarto-xref">Equation&nbsp;4</a>: <span id="eq-moran-I"><span class="math display">
\text{Moran's I} = \frac{M\sum_i\sum_jw_{ij}(x_i-\bar x)(x_j-\bar x)}{\sum_i\sum_jw_{ij}\sum_i(x_i-\bar x)^2 \qquad}
\tag{4}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">x_h</span> is defined as <span class="math inline">x_h = 0</span> if <span class="math inline">h</span> is occupied by red agents and <span class="math inline">x_h = 1</span> if <span class="math inline">h</span> is occupied by yellow agents.</li>
<li><span class="math inline">x_i, x_j</span> denote the values of <span class="math inline">x_h</span> in cells i, j;</li>
<li><span class="math inline">M = Round((1-d)\times N^2)</span> is the overall number of occupied cells,</li>
<li><span class="math inline">\bar x</span> is the mean value of <span class="math inline">x_h</span> over the occupied cells,</li>
<li><span class="math inline">w_{ij} = \begin{cases} 1 &amp; \text{if } j \in U(i) \\ 0 &amp; \text{otherwise}\end{cases}</span></li>
</ul>
<p>Interpretation of the statistic</p>
<ul>
<li>A value of Moran’s I close to 0 represents an integrated region.</li>
<li>A value close to 1 represents a fully segregated region.</li>
</ul>
</section>
<section id="sec-interaction-or-exposure-index" class="level3">
<h3 class="anchored" data-anchor-id="sec-interaction-or-exposure-index">Interaction or Exposure Index (B)</h3>
<p>The <strong>Interaction Index</strong>, also known as the <strong>Exposure Index</strong>, is a measure of potential contact or interaction between different groups in a geographic area. It measures the probability that a member of one group will come into contact with a member of another group.</p>
<p>The formula for the Interaction Index (B) between group X and group Y is:</p>
<p><span id="eq-interaction-index"><span class="math display">
B(X, Y) = \sum_{i=1}^{n} \frac{x_i}{X} \frac{y_i}{T_i} \qquad
\tag{5}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">n</span> is the total number of tracts.</li>
<li><span class="math inline">x_i</span> is the population of group <span class="math inline">X</span> in tract $<span class="math inline">i</span>.</li>
<li><span class="math inline">X</span> is the total population of group <span class="math inline">X</span> in all tracts.</li>
<li><span class="math inline">y_i</span> is the population of group Y in tracts <span class="math inline">i</span>.</li>
<li><span class="math inline">T_i</span> is the total population in area <span class="math inline">i</span>.</li>
<li>The sum is taken over all areas <span class="math inline">i</span>.</li>
</ul>
<p>Interpretation:</p>
<ul>
<li>The <strong>Interaction Index</strong> has values ranging from 0 to 1.</li>
<li>A value of 0 indicates complete segregation.</li>
<li>A value of 1 indicates complete integration.</li>
</ul>
</section>
<section id="sec-segregation-in-multiple-categories-entropy-index" class="level3">
<h3 class="anchored" data-anchor-id="sec-segregation-in-multiple-categories-entropy-index">Segregation in Multiple Categories: Entropy Index</h3>
<p>Both the Index of Dissimilarity and Interaction Index can only measure the segregation of two groups compared to each other.</p>
<p>The <strong>Entropy Index</strong> is a measure of diversity that measures the spatial distribution of multiple groups simultaneously. It may be used to quantify segregation in a population across multiple groups. It is calculated as follows:</p>
<p><span id="eq-entropy-index"><span class="math display">
\text{{Entropy Index}} = -\sum_{i=1}^{n} p_{ij} \log(p_{ij}) \qquad
\tag{6}</span></span></p>
<p>In this formula:</p>
<ul>
<li><span class="math inline">n</span> is the total number of groups.</li>
<li><span class="math inline">p_{ij}= \frac{n_{ij}}{n_i}</span> is the ratio of group <span class="math inline">i</span> in cell <span class="math inline">j</span></li>
<li><span class="math inline">n_{ij}</span> = number of population of <span class="math inline">j</span><sup>th</sup> ethnicity in cell <span class="math inline">i</span></li>
<li><span class="math inline">n_{i}</span> =total population in cell <span class="math inline">i</span></li>
<li>The sum is taken over all groups <span class="math inline">i</span> in each cell <span class="math inline">j</span>.</li>
<li>The logarithm is typically base 2 or base <code>e</code> (natural logarithm), depending on the context.</li>
</ul>
<p>Interpretation: - The Entropy Index ranges from 0 (no diversity, all members belong to the same group) to <code>log(n)</code> (maximum diversity, members are evenly distributed across all groups). - In the context of segregation, a lower Entropy Index indicates higher segregation (less diversity within areas), while a higher Entropy Index indicates lower segregation (more diversity within areas).</p>
</section>
</section>
<section id="segregation-in-the-wild." class="level2">
<h2 class="anchored" data-anchor-id="segregation-in-the-wild.">Segregation in the Wild.</h2>
<p>The following table based on data from <a href="https://belonging.berkeley.edu/most-least-segregated-cities-in-2020">Most to Least Segregated Cities in 2020 According to 2020 Census Data</a> shows segregation levels in major US cities</p>
<div class="cell tbl-cap-location-top" data-subtitle="with more than 20K people Expectancy based on 2020 census data" title="Segregation in American Cities" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" data-cap-location="top"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itables <span class="im">import</span> show</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seg_high_place.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'City'</span>] <span class="op">=</span> df[<span class="st">'City'</span>].<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>,<span class="dv">20</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>show(df,maxBytes <span class="op">=</span> <span class="dv">200</span> <span class="op">*</span> <span class="dv">1024</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table id="itables_08f69864_8d18_4c3a_88fe_992ebdfebec6" class="display nowrap" data-quarto-disable-processing="true" style="table-layout:auto;width:auto;margin:auto;caption-side:bottom"><caption><p>Segregation in US cities with a population greater than 20k based on
the 2020 census</p> {#e76dfc69}</caption>
<thead>
    <tr style="text-align: right;">
      
      <th>Rank</th>
      <th>City</th>
      <th>Divergence</th>
      <th>Segregation Category</th>
    </tr>
  </thead><tbody><tr>
<td style="vertical-align:middle; text-align:left">
<div style="float:left; margin-right: 10px;">
<a href="https://mwouts.github.io/itables/"><svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="64" viewbox="0 0 500 400" style="font-family: 'Droid Sans', sans-serif;">
    <g style="fill:#d9d7fc">
        <path d="M100,400H500V357H100Z"></path>
        <path d="M100,300H400V257H100Z"></path>
        <path d="M0,200H400V157H0Z"></path>
        <path d="M100,100H500V57H100Z"></path>
        <path d="M100,350H500V307H100Z"></path>
        <path d="M100,250H400V207H100Z"></path>
        <path d="M0,150H400V107H0Z"></path>
        <path d="M100,50H500V7H100Z"></path>
    </g>
    <g style="fill:#1a1366;stroke:#1a1366;">
   <rect x="100" y="7" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="5s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="0" y="107" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="3.5s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="0;0;400" dur="3.5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="207" width="300" height="43">
    <animate attributename="width" values="0;300;0" dur="3s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="100;100;400" dur="3s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="307" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="4s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="4s" repeatcount="indefinite"></animate>
  </rect>
        <g style="fill:transparent;stroke-width:8; stroke-linejoin:round" rx="5">
            <g transform="translate(45 50) rotate(-45)">
                <circle r="33" cx="0" cy="0"></circle>
                <rect x="-8" y="32" width="16" height="30"></rect>
            </g>

            <g transform="translate(450 152)">
                <polyline points="-15,-20 -35,-20 -35,40 25,40 25,20"></polyline>
                <rect x="-15" y="-40" width="60" height="60"></rect>
            </g>

            <g transform="translate(50 352)">
                <polygon points="-35,-5 0,-40 35,-5"></polygon>
                <polygon points="-35,10 0,45 35,10"></polygon>
            </g>

            <g transform="translate(75 250)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>

            <g transform="translate(425 250) rotate(180)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>
        </g>
    </g>
</svg>
</a>
</div>
<div>
Loading ITables v2.1.0 from the internet...
(need <a href="https://mwouts.github.io/itables/troubleshooting.html">help</a>?)</div></td>

</tr></tbody>

</table>
<link href="https://www.unpkg.com/dt_for_itables@2.0.7/dt_bundle.css" rel="stylesheet">
<script type="module">
    import {DataTable, jQuery as $} from 'https://www.unpkg.com/dt_for_itables@2.0.7/dt_bundle.js';

    document.querySelectorAll("#itables_08f69864_8d18_4c3a_88fe_992ebdfebec6:not(.dataTable)").forEach(table => {
        // Define the table data
        const data = [[1, "Detroit city, MI", 0.806, "High Segregation"], [2, "Newark city, NJ", 0.6806, "High Segregation"], [3, "Hialeah city, FL", 0.654, "High Segregation"], [4, "Chicago city, IL", 0.6223, "High Segregation"], [5, "Milwaukee city, WI", 0.5936, "High Segregation"], [6, "Cleveland city, OH", 0.5478, "High Segregation"], [7, "New York city, NY", 0.4379, "High Segregation"], [8, "Irving city, TX", 0.4082, "High Segregation"], [9, "Miami city, FL", 0.4074, "High Segregation"], [10, "St. Louis city, MO", 0.4069, "High Segregation"], [11, "Philadelphia city, P", 0.3974, "High Segregation"], [12, "Dallas city, TX", 0.3968, "High Segregation"], [13, "Irvine city, CA", 0.3876, "High Segregation"], [14, "Santa Ana city, CA", 0.3762, "High Segregation"], [15, "Atlanta city, GA", 0.363, "High Segregation"], [16, "Oakland city, CA", 0.3572, "High Segregation"], [17, "Memphis city, TN", 0.3453, "High Segregation"], [18, "Buffalo city, NY", 0.3362, "High Segregation"], [19, "Baltimore city, MD", 0.3335, "High Segregation"], [20, "Boston city, MA", 0.3333, "High Segregation"], [21, "Fremont city, CA", 0.3297, "High Segregation"], [22, "Washington city, DC", 0.3295, "High Segregation"], [23, "New Orleans city, LA", 0.3226, "High Segregation"], [24, "Houston city, TX", 0.3187, "High Segregation"], [25, "Los Angeles city, CA", 0.3088, "High Segregation"], [26, "Cincinnati city, OH", 0.3006, "High Segregation"], [27, "Jersey City city, NJ", 0.2953, "High Segregation"], [28, "St. Paul city, MN", 0.2949, "High Segregation"], [29, "Orlando city, FL", 0.2877, "High Segregation"], [30, "Baton Rouge city, LA", 0.2817, "High Segregation"], [31, "Little Rock city, AR", 0.2813, "High Segregation"], [32, "Richmond city, VA", 0.2794, "High Segregation"], [33, "Tampa city, FL", 0.2787, "High Segregation"], [34, "Kansas City city, MO", 0.2754, "High Segregation"], [35, "Frisco city, TX", 0.2743, "High Segregation"], [36, "Plano city, TX", 0.2689, "High Segregation"], [37, "Indianapolis city (b", 0.2538, "High Segregation"], [38, "Chula Vista city, CA", 0.2522, "High Segregation"], [39, "San Diego city, CA", 0.2514, "High Segregation"], [40, "Phoenix city, AZ", 0.2429, "High Segregation"], [41, "Charlotte city, NC", 0.2347, "High Segregation"], [42, "St. Petersburg city,", 0.2278, "High Segregation"], [43, "Scottsdale city, AZ", 0.2241, "High Segregation"], [44, "Fort Worth city, TX", 0.2232, "High Segregation"], [45, "Omaha city, NE", 0.2229, "High Segregation"], [46, "Yonkers city, NY", 0.2207, "High Segregation"], [47, "Huntsville city, AL", 0.2206, "High Segregation"], [48, "Minneapolis city, MN", 0.2206, "High Segregation"], [49, "Pittsburgh city, PA", 0.2195, "High Segregation"], [50, "Rochester city, NY", 0.2182, "High Segregation"], [51, "Montgomery city, AL", 0.2135, "High Segregation"], [52, "Oklahoma City city, ", 0.2119, "High Segregation"], [53, "Tulsa city, OK", 0.2118, "High Segregation"], [54, "Columbus city, OH", 0.2088, "High Segregation"], [55, "Long Beach city, CA", 0.2077, "High Segregation"], [56, "Greensboro city, NC", 0.2055, "High Segregation"], [57, "Nashville-Davidson m", 0.203, "High Segregation"], [58, "Denver city, CO", 0.1971, "High Segregation"], [59, "Columbus city, GA", 0.1893, "High Segregation"], [60, "North Las Vegas city", 0.1888, "High Segregation"], [61, "Raleigh city, NC", 0.1878, "High Segregation"], [62, "Norfolk city, VA", 0.1858, "High Segregation"], [63, "San Jose city, CA", 0.1852, "High Segregation"], [64, "Winston-Salem city, ", 0.1851, "High Segregation"], [65, "Garland city, TX", 0.1811, "High Segregation"], [66, "San Francisco city, ", 0.1797, "High Segregation"], [67, "Louisville/Jefferson", 0.1783, "High Segregation"], [68, "Aurora city, CO", 0.1756, "Low-Medium Segregation"], [69, "Sacramento city, CA", 0.1731, "Low-Medium Segregation"], [70, "Jacksonville city, F", 0.1705, "Low-Medium Segregation"], [71, "McKinney city, TX", 0.1698, "Low-Medium Segregation"], [72, "Durham city, NC", 0.1686, "Low-Medium Segregation"], [73, "Amarillo city, TX", 0.1678, "Low-Medium Segregation"], [74, "San Bernardino city,", 0.1673, "Low-Medium Segregation"], [75, "Toledo city, OH", 0.1661, "Low-Medium Segregation"], [76, "Austin city, TX", 0.1613, "Low-Medium Segregation"], [77, "Fort Wayne city, IN", 0.161, "Low-Medium Segregation"], [78, "Lubbock city, TX", 0.1572, "Low-Medium Segregation"], [79, "Fontana city, CA", 0.153, "Low-Medium Segregation"], [80, "Augusta-Richmond Cou", 0.151, "Low-Medium Segregation"], [81, "Arlington city, TX", 0.15, "Low-Medium Segregation"], [82, "Glendale city, AZ", 0.1487, "Low-Medium Segregation"], [83, "Virginia Beach city,", 0.1487, "Low-Medium Segregation"], [84, "Wichita city, KS", 0.1485, "Low-Medium Segregation"], [85, "Las Vegas city, NV", 0.144, "Low-Medium Segregation"], [86, "San Antonio city, TX", 0.1411, "Low-Medium Segregation"], [87, "Tucson city, AZ", 0.1406, "Low-Medium Segregation"], [88, "Stockton city, CA", 0.1402, "Low-Medium Segregation"], [89, "Anaheim city, CA", 0.14, "Low-Medium Segregation"], [90, "Bakersfield city, CA", 0.1318, "Low-Medium Segregation"], [91, "Fresno city, CA", 0.1289, "Low-Medium Segregation"], [92, "Des Moines city, IA", 0.1284, "Low-Medium Segregation"], [93, "Chandler city, AZ", 0.1276, "Low-Medium Segregation"], [94, "Moreno Valley city, ", 0.1253, "Low-Medium Segregation"], [95, "Chesapeake city, VA", 0.1181, "Low-Medium Segregation"], [96, "Lexington-Fayette ur", 0.1166, "Low-Medium Segregation"], [97, "Mesa city, AZ", 0.1146, "Low-Medium Segregation"], [98, "Tacoma city, WA", 0.1135, "Low-Medium Segregation"], [99, "Henderson city, NV", 0.1111, "Low-Medium Segregation"], [100, "Corpus Christi city,", 0.1075, "Low-Medium Segregation"], [101, "Seattle city, WA", 0.1043, "Low-Medium Segregation"], [102, "Worcester city, MA", 0.0999, "Low-Medium Segregation"], [103, "Riverside city, CA", 0.0967, "Low-Medium Segregation"], [104, "Albuquerque city, NM", 0.0966, "Low-Medium Segregation"], [105, "Reno city, NV", 0.0908, "Low-Medium Segregation"], [106, "Gilbert town, AZ", 0.0879, "Low-Medium Segregation"], [107, "Fayetteville city, N", 0.0853, "Low-Medium Segregation"], [108, "Modesto city, CA", 0.0812, "Low-Medium Segregation"], [109, "Madison city, WI", 0.0812, "Low-Medium Segregation"], [110, "Anchorage municipali", 0.0775, "Low-Medium Segregation"], [111, "Portland city, OR", 0.0683, "Low-Medium Segregation"], [112, "El Paso city, TX", 0.0644, "Low-Medium Segregation"], [114, "Lincoln city, NE", 0.0464, "Low-Medium Segregation"], [115, "Cape Coral city, FL", 0.0379, "Low-Medium Segregation"], [116, "Boise City city, ID", 0.0379, "Low-Medium Segregation"], [118, "Spokane city, WA", 0.0219, "Low-Medium Segregation"], [119, "Laredo city, TX", 0.0109, "Low-Medium Segregation"], [113, "Colorado Springs cit", 0.0531, "Integrated"], [117, "Port St. Lucie city,", 0.027, "Integrated"]];

        // Define the dt_args
        let dt_args = {"layout": {"topStart": "pageLength", "topEnd": "search", "bottomStart": "info", "bottomEnd": "paging"}, "order": []};
        dt_args["data"] = data;

        
        new DataTable(table, dt_args);
    });
</script>
</div>
</div>
<p>One more point to consider is, given all the simplifying assumptions, how useful is the scheduling model for modeling reality?</p>
<p>In real life, residential real estate is usually bought through careful deliberation, and the key factors are price per square meter and the largest loan one can get. This seems to be a far cry from the Schelling model. This point is considered in great detail in <span class="citation" data-cites="Hatna2012Schelling">(<a href="#ref-Hatna2012Schelling" role="doc-biblioref">Hatna and Benenson 2012</a>)</span>, which looks at segregation in two mixed cities in Israel.</p>
</section>
<section id="peer_effects" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="peer_effects">Peer Effects</h2>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_peer_effect.jpg" class="img-fluid figure-img"></p>
<figcaption>peer pressure</figcaption>
</figure>
</div></div></section>
<section id="sec-granovettors-model" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-granovettors-model">Granovettor’s Threshold Model</h2>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_protest.jpg" class="img-fluid figure-img"></p>
<figcaption>Granovettor’s model can explain riots</figcaption>
</figure>
</div></div><p><strong>Peer effects</strong> can have a <strong>contagious mechanism</strong> a kin to the spread of diseases. Another aspect of peer effects is called “the tail is wagging the dog,” where a small minority sets the tone for the whole group. Situations where behavior in which the most extremist people at the tail end of the political distribution determine what will happen will always be challenging to predict, for instance, political uprisings like the fall of the <a href="https://en.wikipedia.org/wiki/Berlin_Wall">Berlin Wall</a> and more recently the <a href="https://en.wikipedia.org/wiki/Orange_Revolution">Orange Revolution</a> in Ukraine. In such cases, it is difficult to predict what will happen, and the Granovetter Model explains that it is a microcosm in which we can study why it is so challenging to predict such events.</p>
<p>In <span class="citation" data-cites="granovetter1983threshold granovetter1986threshold granovetter1988threshold">(<a href="#ref-granovetter1983threshold" role="doc-biblioref">Granovetter and Soong 1983</a>, <a href="#ref-granovetter1986threshold" role="doc-biblioref">1986</a>, <a href="#ref-granovetter1988threshold" role="doc-biblioref">1988</a>)</span> the authors discusses <strong>Granovettor’s Threshold Model</strong> which can be described by:</p>
<ul>
<li><span class="math inline">N</span> population size.</li>
<li>Agent <em>j</em> has a participation threshold <span class="math inline">T_j</span> and will only participate if <span class="math inline">T_j</span> others individuals participate.</li>
<li>An Agent with a threshold of 0 will always participate.</li>
<li>An Agent with a threshold of 10 will wait till it sees 10 other agents participating.</li>
</ul>
<p>Thus, the outcome varies depending on the distribution of thresholds.</p>
<p>Assume that there are five individuals and that the behavior is participating in a riot.</p>
<div id="tbl-riot1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-riot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: ready for a riots
</figcaption>
<div aria-describedby="tbl-riot1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th># agents</th>
<th>threshold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Then, we can expect that the first agent will start protesting because her threshold is 0. Then second the agent will join the protest since his threshold is 1. The other thee will now join the protest as their threshold is 2.</p>
<p>With</p>
<div id="tbl-riot2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-riot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: no one riots
</figcaption>
<div aria-describedby="tbl-riot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th># agents</th>
<th>threshold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>We can expect no one will riot even though the collective has a much lower threshold for participation.</p>
<p>With</p>
<div id="tbl-riot3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-riot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: another riots
</figcaption>
<div aria-describedby="tbl-riot3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th># agents</th>
<th>threshold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>1</td>
<td>4</td>
</tr>
<tr class="even">
<td>1</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Every agent will, in turn, join the protest even though the collective isn’t as polarized as the previous one. We can see this is a case where the extremists set the tone.</p>
<p>We can conclude that in this model of collective action, participation is more likely when :</p>
<ol type="1">
<li>The thresholds are lower</li>
<li>There is a greater variation of thresholds.</li>
</ol>
<p>The second point is why it is so hard to predict if a riot or a run on a bank will take place. First, you need to estimate the level of discontentment and also the distribution of thresholds.</p>
</section>
<section id="sec-standing_ovation_model" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-standing_ovation_model">The Standing Ovation Model</h2>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_standing_ovation_01.jpg" class="img-fluid figure-img"></p>
<figcaption>Standing ovation</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_standing_ovation_02.jpg" class="img-fluid figure-img"></p>
<figcaption>Standing ovation</figcaption>
</figure>
</div></div>
<p>Granovettor’s Threshold model can explain participation in risky activities where risks and rewards are tied to the number of peers participating.</p>
<blockquote class="blockquote">
<p>The basic SOP can be stated as follows: A brilliant economics lecture ends, and the audience begins to applaud. The applause builds, and tentatively, a few audience members may or may not decide to stand. Does a standing ovation ensue, or does the enthusiasm fizzle? — <span class="citation" data-cites="miller2004standing">(<a href="#ref-miller2004standing" role="doc-biblioref">Miller and Page 2004</a>)</span></p>
</blockquote>
<p>The Formal Model:</p>
<ul>
<li>Agents are seated in a rectangular auditorium with <span class="math inline">R</span> rows and <span class="math inline">C</span> seats per row.</li>
<li>At the conclusion of a performance, each agent makes an evaluation of the performance’s quality.</li>
<li>Let <span class="math inline">q_{ij} ∈ Q_{ij} = [0, 1]</span> represent the quality signal received by the audience member seated in the <span class="math inline">i</span>th row and <span class="math inline">j</span>th seat.
<ul>
<li>Higher values of <span class="math inline">q_{ij}</span> represent greater perceived quality.</li>
<li>For the moment, values may be thought of as either private or common with idiosyncratic noise, or some convex combination of the two.</li>
</ul></li>
<li>Each audience member possesses an exogenous threshold level in addition to his or her quality evaluation.
<ul>
<li>The threshold level for the agent in the <span class="math inline">i</span><sup>th</sup> row and <span class="math inline">j</span><sup>th</sup> seat, <span class="math inline">T_{ij}</span> , equals the minimal quality required for that agent to stand immediately.</li>
<li>Thus, if an audience member’s private value weakly exceeds the threshold, that is if <span class="math inline">q_{ij} \ge T_{ij}</span> , she stands immediately. If not, she remains seated.</li>
</ul></li>
<li>Let <span class="math inline">s^t_{ij} \in \{0, 1\}</span> denote whether or not the audience member is standing <span class="math inline">(s^t_{ij}=1)</span> or sitting <span class="math inline">(s^t_{ij}=0)</span> <span class="math inline">t</span> time periods after the completion of the performance, and let <span class="math inline">S^t</span> be the total number of audience members standing at time <span class="math inline">t</span>. Therefore,</li>
</ul>
<p><span class="math display">
S^0  = \sum ^C_{j=1}\sum ^R_{i=1} s^0_{ij}
</span></p>
<p>equals the number of agents standing immediately. In interesting cases, only a fraction <span class="math inline">(0 &lt; S 0 &lt; R \cdot C)</span> of the audience stands immediately. With a portion of the audience standing, those who remain seated must decide whether to stand, and those audience members standing must decide whether to remain standing or to sit. Both decisions rely on local information—possibly the number of neighbors standing or the percentage of audience members within sight who are standing—as well as the initial quality appraisal of the individual.</p>
<p>For example, someone seated surrounded entirely by people who are standing most likely will stand, unless she abhorred the performance. Similarly, unless she felt that the performance was stupendous, an isolated standing person may decide to sit if her neighbors do not join the standing ovation quickly.</p>
<p>The behavior of an audience member at a particular point in time can be represented by a heuristic that maps her information and quality appraisal into an action, either sit or stand. Periods are considered as discrete units. The continuous time case shall be addressed later in the discussion of random asynchronous and endogenous asynchronous updating. Let <span class="math inline">K_{ij}</span> be the seat assignments visible to the audience member in the ith row and jth seat. Define a <em>behavioral rule</em> at time <span class="math inline">t &gt; 0 \text{ by } F^t : K^t × Q_{ij} \to \{0, 1\} \text{ for } t \ge 1</span>. Recall that in period 0, the decision to stand depends only on the agent’s threshold and <span class="math inline">q_{ij}</span>.</p>
<hr>
<p>The authors discuss the math and internals of their models as form of noisy channel. Agents need to fuse a signal based on their private information with the information coming from their peers and arrive at a binary decision.</p>
<p>The standing ovation model by Scott and Miller is intentionally presented in the most vague form according to their later publication. This is rather annoying as without a more formal spec it isn’t possible to reproduce any results. Also most people don’t actually seem to implement it as explained in the lesson or the paper.</p>
<p>I found the paper <span class="citation" data-cites="miller2004standing">(<a href="#ref-miller2004standing" role="doc-biblioref">Miller and Page 2004</a>)</span> rather tiresome and had to have a few goes at it. The authors’ exhortation exaltation on the grandeur of their model is matched by the vagueness of its definitions — basically there are any number of variants and extensions of the standing ovation models. Criticism aside I noticed some point of interest in the paper:</p>
<ol type="1">
<li><strong>cascades</strong> I was a momentarily shocked to see many references to <a href="https://en.wikipedia.org/wiki/Information_cascade">information cascades</a> in the paper, which I mentioned above. It is evident the authors are well versed on this subject well begging the question, why it this not covered in the course but rather named tips etc.</li>
<li><strong>ANTs</strong> (Active Nonlinear Tests) are another interesting idea - i.e.&nbsp;using them to break the model. This seems to be a from of fuzz testing. At this point though I was still more interested in demonstrating that the model actually works.</li>
<li>Eventually, I noticed there was a section called the formal model which defined the model more precisely.</li>
<li>There is also a section on implementing an ABM version with a number of variations they had considered which I summarized below, indicating if I have implemented them.</li>
</ol>
<p>Rather than go into great detail about the model, I coded it using Mesa. Coding this model required some customization of the framework and that makes more advanced but also more educational. Also I can say that the lesson explained the model rather poor and that only by implementing the model did I get to understand this model.</p>
<ul>
<li>Agents are initialized as either standing or not, as with no one is standing at the start the will be no standing ovation.</li>
<li>At each time step, agents decide to stand based on a Signal &gt; Threshold where the signal is based on the Quality and an error. <span class="math inline">S=Q+\epsilon &gt; T</span></li>
</ul>
<p>Some variations they discuss are</p>
<ol type="1">
<li><p>updating: <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<ul>
<li><strong>Synchronous Updating</strong> At the start of each discrete time period, all agents update in unison.</li>
<li><strong>Asynchronous-Random Updating</strong> Within each discrete time period, the agents are permuted into a random order and updated in that order.</li>
<li><strong>Asynchronous-Incentive-Based Updating</strong> Within each discrete time period, the agents update one at a time based on an explicit ordering rule that has agents who are least like the people that surround them move first</li>
</ul></li>
<li><p>The following neighborhoods are suggested <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<ul>
<li>Five Neighbors (left, right, front left, front, front right)</li>
<li>Cones add to the above two more rows in front, each growing by one on each side.</li>
</ul></li>
<li><p>Do agents sit if they are all alone?</p></li>
<li><p>Topology is the world</p>
<ul class="task-list">
<li><label><input type="checkbox">a square or</label></li>
<li><label><input type="checkbox">a torus to avoid edge effects.</label></li>
<li><label><input type="checkbox" checked="">a cylinder (square with left and tight wrapping)</label></li>
</ul></li>
<li><p>Different geometries</p></li>
<li><p>Weighting <a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<ul>
<li>of left right neighbors</li>
<li>of rows in the funnel by inverse square distance (row_2: 1/4 row_3: 1/9)</li>
</ul></li>
<li><p>Can we code partners and group agents. <a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p></li>
<li><p>Hecklers &amp; Stooges - these never or always stand. <a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<ul>
<li>Can we estimate how many are needed to ensure/prevent a SO?</li>
<li>Can we add a seat price for the above 2 at limit 10 im middle?</li>
</ul></li>
<li><p><label><input type="checkbox" checked="">What if every so often an agent “turns round” to view the seats behind them? This is the same as Moore neighborhood <a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></label></p></li>
<li><p><label><input type="checkbox">track information cascades.</label></p>
<ol type="1">
<li><label><input type="checkbox">each agent should have list called cascade - if standing it is in it otherwise empty.</label></li>
<li><label><input type="checkbox">each agent should keep track of the sim_step when it stands</label></li>
<li><label><input type="checkbox">when triggered the agent copies the cascade list of any agent that stood up in the previous time step.</label></li>
<li><label><input type="checkbox">it should grab the cascade id list from his the peer that triggered him store it in locally.</label></li>
</ol></li>
<li><p>generate an animation</p>
<ul class="task-list">
<li><label><input type="checkbox">of the state using the image of each step</label></li>
<li><label><input type="checkbox">animate agents who by blinking their weighted neighborhood.</label></li>
<li><label><input type="checkbox">animate information cascades - cycle colors from white to black of recently changed agents.</label></li>
<li><label><input type="checkbox">we also annotate each location using the length of its cascade<br>
</label></li>
</ul></li>
<li><p>do a run to test the paper’s suggested metrics</p></li>
</ol>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;<span class="citation" data-cites="miller2004standing">Miller and Page (<a href="#ref-miller2004standing" role="doc-biblioref">2004</a>)</span></p></div><div id="fn6"><p><sup>6</sup>&nbsp;<span class="citation" data-cites="miller2004standing">Miller and Page (<a href="#ref-miller2004standing" role="doc-biblioref">2004</a>)</span></p></div><div id="fn7"><p><sup>7</sup>&nbsp;<span class="citation" data-cites="Cole2020SOM">Cole (<a href="#ref-Cole2020SOM" role="doc-biblioref">2020</a>)</span></p></div><div id="fn8"><p><sup>8</sup>&nbsp;<span class="citation" data-cites="Cole2020SOM">Cole (<a href="#ref-Cole2020SOM" role="doc-biblioref">2020</a>)</span></p></div><div id="fn9"><p><sup>9</sup>&nbsp;<span class="citation" data-cites="Cole2020SOM">Cole (<a href="#ref-Cole2020SOM" role="doc-biblioref">2020</a>)</span></p></div><div id="fn10"><p><sup>10</sup>&nbsp;<span class="citation" data-cites="Cole2020SOM">Cole (<a href="#ref-Cole2020SOM" role="doc-biblioref">2020</a>)</span></p></div></div><p>The model has the following elements.</p>
<ul>
<li><span class="math inline">Q \in [0,100]</span> is the quality of the show</li>
<li><span class="math inline">\epsilon</span> is an error or diversity</li>
<li><span class="math inline">S=Q+\epsilon</span> is the signal</li>
<li><span class="math inline">T</span> is the personal threshold</li>
<li>Trigger
<ul>
<li>initially <span class="math inline">Q&gt;T</span></li>
<li>later <span class="math inline">S&gt;T</span></li>
</ul></li>
</ul>
<p>Three metrics:</p>
<ol type="1">
<li></li>
</ol>
<div id="e517e22f" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mesa</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AudienceMember(mesa.Agent):</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, unique_id, model, threshold<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(unique_id, model)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.standing <span class="op">=</span> <span class="va">False</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.threshold <span class="op">=</span> threshold  <span class="co"># The proportion of neighbors standing that will trigger this agent to stand</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Implement the logic for deciding whether to stand or not</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        neighbors <span class="op">=</span> <span class="va">self</span>.model.grid.get_neighbors(<span class="va">self</span>.pos, moore<span class="op">=</span><span class="va">True</span>, include_center<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>.standing:</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            standing_neighbors <span class="op">=</span> <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> neighbor <span class="kw">in</span> neighbors <span class="cf">if</span> neighbor.standing)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> standing_neighbors <span class="op">/</span> <span class="bu">len</span>(neighbors) <span class="op">&gt;=</span> <span class="va">self</span>.threshold:</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.standing <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StandingOvationModel(mesa.Model):</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Model class for the Standing Ovation Model.</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, width, height, initial_standing<span class="op">=</span><span class="fl">0.1</span>, threshold<span class="op">=</span><span class="fl">0.5</span>,seed<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">        Create a new Standing Ovation Model.</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">        Args:</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(seed<span class="op">=</span>seed)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.grid <span class="op">=</span> mesa.space.SingleGrid(width, height, torus<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule <span class="op">=</span> mesa.time.RandomActivation(<span class="va">self</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.datacollector <span class="op">=</span> mesa.DataCollector(</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                model_reporters<span class="op">=</span>{<span class="st">"Standing"</span>: <span class="kw">lambda</span> m: <span class="bu">sum</span>([<span class="dv">1</span> <span class="cf">for</span> a <span class="kw">in</span> m.schedule.agents <span class="cf">if</span> a.standing])},</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                agent_reporters<span class="op">=</span>{</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"x"</span>: <span class="kw">lambda</span> a: a.pos[<span class="dv">0</span>],</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"y"</span>: <span class="kw">lambda</span> a: a.pos[<span class="dv">1</span>],</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"standing"</span>: <span class="kw">lambda</span> a: a.standing,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create agents</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(width<span class="op">*</span>height):</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            agent <span class="op">=</span> AudienceMember(i, <span class="va">self</span>, threshold<span class="op">=</span><span class="va">self</span>.random.uniform(<span class="fl">0.1</span>,<span class="fl">.7</span>))</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.schedule.add(agent)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Place agent</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> i <span class="op">%</span> width  </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> i <span class="op">//</span> width  </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.grid.place_agent(agent, (x, y))</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Randomly decide if the agent is standing at the beginning</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.random.random() <span class="op">&lt;</span> initial_standing:</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>                agent.standing <span class="op">=</span> <span class="va">True</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> step(<span class="va">self</span>):</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co">        Run one step of the model.</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.schedule.step()</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.datacollector.collect(<span class="va">self</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some code to visualize the state</p>
<div id="0fb1f740" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> MultipleLocator, FormatStrFormatter</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_grid(model,model_name,state_name):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Plot the current state of the grid with a graph paper-like background.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.zeros((model.grid.width, model.grid.height))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a ,(x,y) <span class="kw">in</span> model.grid.coord_iter():        </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> a <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            grid[x][y] <span class="op">=</span> <span class="dv">1</span> <span class="cf">if</span> a.standing <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    ax.imshow(grid, cmap<span class="op">=</span><span class="st">'Greys'</span>, interpolation<span class="op">=</span><span class="st">'nearest'</span>, extent<span class="op">=</span>[<span class="dv">0</span>, model.grid.width, <span class="dv">0</span>, model.grid.height])</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up the minor grid lines</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="dv">0</span>, model.grid.width, <span class="dv">1</span>), minor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(np.arange(<span class="dv">0</span>, model.grid.height, <span class="dv">1</span>), minor<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up the major grid lines (every fifth line)</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(np.arange(<span class="dv">0</span>, model.grid.width, <span class="dv">5</span>), minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    ax.set_yticks(np.arange(<span class="dv">0</span>, model.grid.height, <span class="dv">5</span>), minor<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize the appearance of the grid lines</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    ax.grid(which<span class="op">=</span><span class="st">"minor"</span>, color<span class="op">=</span><span class="st">"blue"</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    ax.grid(which<span class="op">=</span><span class="st">"major"</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hide the major tick labels</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(which<span class="op">=</span><span class="st">"major"</span>, labelbottom<span class="op">=</span><span class="va">True</span>, labelleft<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>state_name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="16a45b09" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the model</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>so_model <span class="op">=</span> StandingOvationModel(<span class="dv">20</span>, <span class="dv">20</span>, initial_standing<span class="op">=</span><span class="fl">0.1</span>, threshold<span class="op">=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/oren/.local/lib/python3.10/site-packages/mesa/time.py:82: FutureWarning:

The AgentSet is experimental. It may be changed or removed in any and all future releases, including patch releases.
We would love to hear what you think about this new feature. If you have any thoughts, share them with us here: https://github.com/projectmesa/mesa/discussions/1919
</code></pre>
</div>
</div>
<p>plot the initial state</p>
<div id="cell-fig-so-start" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="op">=</span> <span class="st">"Standing Ovation"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>state_name <span class="op">=</span> <span class="st">"Start State"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>plot_grid(so_model,model_name,state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-so-start" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-so-start-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="w02_files/figure-html/fig-so-start-output-1.png" width="415" height="431" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-so-start-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Standing Ovation Model - Initial Grid State
</figcaption>
</figure>
</div>
</div>
</div>
<p>Simulate the standing ovation model for 15 steps.</p>
<div id="56da5a45" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the model for a certain number of steps</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">15</span>):</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    so_model.step()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the final state.</p>
<div id="cell-fig-so-end" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="op">=</span> <span class="st">"Standing Ovation"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>state_name <span class="op">=</span> <span class="st">"Final State"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plot_grid(so_model,model_name,state_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-so-end" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-so-end-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="w02_files/figure-html/fig-so-end-output-1.png" width="415" height="431" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-so-end-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Standing Ovation Model - Final Grid State
</figcaption>
</figure>
</div>
</div>
</div>
<p>Let’s look at the growth of the ovation.</p>
<div id="cell-fig-so-analysis1" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>so_model_df <span class="op">=</span> so_model.datacollector.get_model_vars_dataframe()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>so_model_df.head()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#so_model_df.Standing.plot()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-so-analysis1" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="8">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-so-analysis1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Standing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>154</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>202</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>239</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>261</td>
</tr>
</tbody>
</table>

</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-so-analysis1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Standing Ovation Model - Growth Analysis
</figcaption>
</figure>
</div>
</div>
<p>The following results come from this model.</p>
<ol type="1">
<li>Higher <span class="math inline">Q</span> will result in bigger ovations.</li>
<li>Lower <span class="math inline">T</span> will result in bigger ovations.</li>
<li>A lower percentage of standing <span class="math inline">X</span> will cause more standing ovations. If <span class="math inline">X</span> is large, an agent won’t stand up despite many people standing up.</li>
<li>If <span class="math inline">X</span> is small, people will jump on any bandwagon.</li>
<li>For <span class="math inline">Q &lt; T</span>, greater variation in <span class="math inline">\epsilon</span> will help the standing ovation spread by increasing a contagion-like effect - as we saw in the previous model.</li>
</ol>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_theatre_01.jpg" class="img-fluid figure-img"></p>
<figcaption>Standing ovation - Celebrity view</figcaption>
</figure>
</div></div><p>Standing ovation is more likely to emerge when:</p>
<ol type="1">
<li>If Quality is higher.</li>
<li>Thresholds are lower,</li>
<li>There is a more substantial peer effect</li>
<li>There is a greater variation in thresholds or errors.</li>
</ol>
<p>The first three are obvious. Scott suggested that the last one was discovered by implementing his standing ovation model. Once we know about the Granovettor model’s requirement for agents to have different thresholds to enable participation to spread, it is obvious.</p>
<p>The model simplifies reality by excluding factors like the shape of the theater and the locations where people are situated or by assuming people act independently when most people come in pairs or larger groups.</p>
<p>Scott later discusses <strong>social roles</strong>, which he calls celebrities and academics, that would emerge in a more sophisticated model with a spatial layout with a front and a back. In the first chapter of Micro Motives and Macro Behavior, I later noticed that Schelling analyzed a surprising sitting arrangement that emerged in one of his talks, eliminating many hypotheses.</p>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_theatre_02.jpg" class="img-fluid figure-img"></p>
<figcaption>Standing ovation - Academic’s view</figcaption>
</figure>
</div></div><p>Agents in the front may be assigned a “celebrity” role; they can influence everybody behind them but are not influenced by others. Agents in the back may be assigned an “academic” role. They can see their immediate neighborhood but are unseen by many others.</p>
<p>Scott claims that the standing ovation model is helpful in other scenarios, which is termed fertility for models. The standing ovation model may be useful in modeling collective action problems. However, he doesn’t make a very strong case.</p>
</section>
<section id="sec-identification_problem" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-identification_problem">The Identification problem</h2>

<div class="no-row-height column-margin column-container"><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_big_short.jpg" class="img-fluid figure-img"></p>
<figcaption>the big short</figcaption>
</figure>
</div><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mt_connected_book.jpg" class="img-fluid figure-img"></p>
<figcaption>connected</figcaption>
</figure>
</div></div>
<p>The challenge of distinguishing whether individuals associate with one another due to sorting (as discussed by Schelling) or peer influence (illustrated by the standing ovation example) varies in complexity. In specific scenarios, like Racial segregation, the distinction is straightforward.</p>
<p>However, the situation becomes murkier in other instances. Consider the phenomenon of happy people gravitating towards other happy individuals and the same pattern is observed among those who are unhappy. In these cases, both sorting and peer effects could be at play, and often, it’s challenging to pinpoint which is the driving force since the end result appears the same for both mechanisms. Therefore, simply observing the outcome won’t provide clarity. Sorting, characterized by the physical movement of individuals, necessitates dynamic data for accurate identification.</p>
<p>Author <a href="https://en.wikipedia.org/wiki/Bill_Bishop_(author)">Bill Bishop</a>, discusses sorting in <span class="citation" data-cites="bishop2009big">(<a href="#ref-bishop2009big" role="doc-biblioref">Bishop 2009</a>)</span> the. For example, in recent years, many counties in the USA have become more polarized. Bishop argues that this occurs due to sorting. However, gerrymandering is a more likely root cause.</p>
<p><a href="https://en.wikipedia.org/wiki/Nicholas_Christakis">Nicholas A. Christakis</a> and <a href="https://en.wikipedia.org/wiki/James_H._Fowler">James H. Fowler</a>, discusses peer effects in <span class="citation" data-cites="christakis2009connected">(<a href="#ref-christakis2009connected" role="doc-biblioref">Christakis and Fowler 2009</a>)</span>.</p>
<p>With migration data, it’s simpler to establish whether like-mindedness is caused by sorting or peer effects.</p>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References</h3>
<p>Note: this page is based on the following source:</p>
<ul>
<li><span class="citation" data-cites="page2017modelthinking">(<a href="#ref-page2017modelthinking" role="doc-biblioref">Page 2014</a>)</span> MOOC, Course material &amp; Transcripts.</li>
<li>TA Notes by <span class="citation" data-cites="fisher2017modelthinking">(<a href="#ref-fisher2017modelthinking" role="doc-biblioref">Fisher 2014</a>)</span>.</li>
<li>Student notes by in <span class="citation" data-cites="kleinikink2016naturalmoney">(<a href="#ref-kleinikink2016naturalmoney" role="doc-biblioref">Klein Ikink 2016</a>)</span> and <span class="citation" data-cites="groh2017model">(<a href="#ref-groh2017model" role="doc-biblioref">Groh 2017</a>)</span>.</li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Akerlof1970Lemons" class="csl-entry" role="listitem">
Akerlof, George A. 1970. <span>“The Market for "Lemons": Quality Uncertainty and the Market Mechanism.”</span> <em>The Quarterly Journal of Economics</em> 84 (3): 488–500.
</div>
<div id="ref-bishop2009big" class="csl-entry" role="listitem">
Bishop, B. 2009. <em>The Big Sort: Why the Clustering of Like-Minded America Is Tearing Us Apart</em>. Houghton Mifflin Harcourt.
</div>
<div id="ref-christakis2009connected" class="csl-entry" role="listitem">
Christakis, N. A., and J. H. Fowler. 2009. <em>Connected: The Surprising Power of Our Social Networks and How They Shape Our Lives</em>. Little, Brown.
</div>
<div id="ref-Cole2020SOM" class="csl-entry" role="listitem">
Cole, Lewis. 2020. <span>“Standing Ovation Model.”</span> 2020. <a href="https://lewiscoleblog.com/standing-ovation">https://lewiscoleblog.com/standing-ovation</a>.
</div>
<div id="ref-duncan1955methodological" class="csl-entry" role="listitem">
Duncan, Otis Dudley, and Beverly Duncan. 1955. <span>“A Methodological Analysis of Segregation Indexes.”</span> <em>American Sociological Review</em> 20 (2): 210–17.
</div>
<div id="ref-fisher2017modelthinking" class="csl-entry" role="listitem">
Fisher, Steve. 2014. <span>“Model Thinking – TA Notes.”</span> <a href="https://www.coursera.org/learn/model-thinking" class="uri">https://www.coursera.org/learn/model-thinking</a>; Coursera. November 2014.
</div>
<div id="ref-granovetter1983threshold" class="csl-entry" role="listitem">
Granovetter, Mark, and Roland Soong. 1983. <span>“Threshold Models of Diffusion and Collective Behavior.”</span> <em>Journal of Mathematical Sociology</em>.
</div>
<div id="ref-granovetter1986threshold" class="csl-entry" role="listitem">
———. 1986. <span>“Threshold Models of Interpersonal Effects in Consumer Demand.”</span> <em>Journal of Economic Behavior &amp; Organization</em> 7 (1): 83–99.
</div>
<div id="ref-granovetter1988threshold" class="csl-entry" role="listitem">
———. 1988. <span>“Threshold Models of Diversity: Chinese Restaurants, Residential Segregation, and the Spiral of Silence.”</span> <em>Sociological Methodology</em>, 69–104.
</div>
<div id="ref-groh2017model" class="csl-entry" role="listitem">
Groh, Rainer. 2017. <span>“Model Thinking - Course Notes by Rainer Groh.”</span> <a href="https://aerospaceengineeringblog.com/wp-content/uploads/2017/11/ModelThinking.pdf" class="uri">https://aerospaceengineeringblog.com/wp-content/uploads/2017/11/ModelThinking.pdf</a>. November 2017.
</div>
<div id="ref-Hatna2012Schelling" class="csl-entry" role="listitem">
Hatna, Erez, and Itzhak Benenson. 2012. <span>“The Schelling Model of Ethnic Residential Dynamics: Beyond the Integrated - Segregated Dichotomy of Patterns.”</span> <em>J. Artificial Societies and Social Simulation</em> 15 (1). <a href="http://dblp.uni-trier.de/db/journals/jasss/jasss15.html#HatnaB12">http://dblp.uni-trier.de/db/journals/jasss/jasss15.html#HatnaB12</a>.
</div>
<div id="ref-kleinikink2016naturalmoney" class="csl-entry" role="listitem">
Klein Ikink, Bart. 2016. <span>“Model Thinking.”</span> <a href="https://naturalmoney.org/modelthinking-01.html" class="uri">https://naturalmoney.org/modelthinking-01.html</a>. March 2016.
</div>
<div id="ref-miller2004standing" class="csl-entry" role="listitem">
Miller, John H, and Scott E Page. 2004. <span>“The Standing Ovation Problem.”</span> <em>Complexity</em>. Wiley Subscription Services, Inc., A Wiley Company Hoboken.
</div>
<div id="ref-Mauro2022segregation" class="csl-entry" role="listitem">
Nanni, Mirco. 2023. <span>“Segregation Models.”</span> 2023. <a href="http://didawiki.cli.di.unipi.it/lib/exe/fetch.php/geospatialanalytics/gsa/lesson_09_-_segregation.pdf">http://didawiki.cli.di.unipi.it/lib/exe/fetch.php/geospatialanalytics/gsa/lesson_09_-_segregation.pdf</a>.
</div>
<div id="ref-page2017modelthinking" class="csl-entry" role="listitem">
Page, Scott E. 2014. <span>“Model Thinking [MOOC].”</span> <a href="https://www.coursera.org/learn/model-thinking" class="uri">https://www.coursera.org/learn/model-thinking</a>; Coursera. November 2014.
</div>
<div id="ref-schelling1969models" class="csl-entry" role="listitem">
Schelling, Thomas C. 1969. <span>“Models of Segregation.”</span> <em>The American Economic Review</em> 59 (2): 488–93.
</div>
<div id="ref-schelling1971dynamic" class="csl-entry" role="listitem">
———. 1971. <span>“Dynamic Models of Segregation.”</span> <em>Journal of Mathematical Sociology</em> 1 (2): 143–86.
</div>
<div id="ref-schelling1978micromotives" class="csl-entry" role="listitem">
———. 1978. <em>Micromotives and Macrobehavior</em>. Fels Lectures on Public Policy Analysis. Norton. <a href="https://www.google.com/books?id=4C5mQgAACAAJ">https://www.google.com/books?id=4C5mQgAACAAJ</a>.
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{2023,
  author = {},
  title = {Lesson 2 - {Segregation} and {Peer} {Effects}},
  date = {2023-08-02},
  url = {https://orenbochman.github.io/notes-model-thinking/posts/w02.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-2023" class="csl-entry quarto-appendix-citeas" role="listitem">
<span>“Lesson 2 - Segregation and Peer Effects.”</span> 2023. August 2,
2023. <a href="https://orenbochman.github.io/notes-model-thinking/posts/w02.html">https://orenbochman.github.io/notes-model-thinking/posts/w02.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.quarto\.org\/custom");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2023-2025, Oren Bochman</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/OrenBochman/notes-model-thinking/edit/main/posts/w02.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/OrenBochman/notes-model-thinking/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with 💛 and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>